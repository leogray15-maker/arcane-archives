<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Live Calls | The Arcane Archives</title>
<link rel="icon" href="ArcaneA.png" />

<link rel="stylesheet" href="../notion-arcane.css">

<style>
/* (STYLES UNCHANGED â€” yours are solid) */
</style>

<script type="module" src="../notion-protect.js"></script>
</head>

<body>
<a href="dashboard.html" class="back-btn">â† Back to Dashboard</a>

<div class="header">
  <div class="logo">
    <img src="ArcaneA.png" alt="Logo">
    THE ARCANE ARCHIVES
  </div>
</div>

<div class="main-content">
  <div class="page-card">
    <div class="page-card-inner">
      <div class="page-header">
        <div class="page-header-eyebrow">Live Rooms</div>
        <h1>ğŸ™ï¸ <span>Live Calls</span></h1>
        <p>
          Join the brotherhood in real time â€” strategy, accountability, and execution-focused calls.
        </p>
      </div>

      <div class="calls-grid">

        <div class="call-card">
          <div class="call-icon">ğŸ”¥</div>
          <div class="call-title">Weekly Masterclass</div>
          <div class="call-time">ğŸ“… Every Monday at 7 PM UK</div>
          <div class="call-description">
            Deep dive into advanced strategies for business, wealth creation, and personal mastery.
          </div>
          <a href="#" class="call-btn" data-call="weekly">Join Call</a>
        </div>

        <div class="call-card">
          <div class="call-icon">ğŸ’ª</div>
          <div class="call-title">Accountability Check-In</div>
          <div class="call-time">ğŸ“… Every Wednesday at 6 AM UK</div>
          <div class="call-description">
            Morning accountability call to set intentions and review progress.
          </div>
          <a href="#" class="call-btn" data-call="accountability">Join Call</a>
        </div>

        <div class="call-card">
          <div class="call-icon">ğŸ¯</div>
          <div class="call-title">Friday Focus Session</div>
          <div class="call-time">ğŸ“… Every Friday at 5 PM UK</div>
          <div class="call-description">
            Weekly review, wins, and planning for the week ahead.
          </div>
          <a href="#" class="call-btn" data-call="focus">Join Call</a>
        </div>

        <div class="call-card">
          <div class="call-icon">ğŸ§ </div>
          <div class="call-title">Sunday Strategy</div>
          <div class="call-time">ğŸ“… Every Sunday at 8 PM UK</div>
          <div class="call-description">
            Strategic planning session for the upcoming week.
          </div>
          <a href="#" class="call-btn" data-call="strategy">Join Call</a>
        </div>

      </div>
    </div>
  </div>
</div>

<footer>
  <div class="footer-links">
    <a href="index.html">Home</a>
    <a href="Privacy-policy.html">Privacy Policy</a>
    <a href="terms-of-service.html">Terms of Service</a>
    <a href="refund-policy.html">Refund Policy</a>
  </div>
  <div class="footer-bottom">
    &copy; 2024 The Arcane Archives. All rights reserved.
  </div>
</footer>

<script type="module">
import { protectPage, updateUserAvatar, db } from './auth-guard.js';
import { doc, updateDoc, increment, serverTimestamp } 
  from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js';

let currentUser = null;

protectPage({
  onSuccess: (user, userData) => {
    currentUser = user;
    updateUserAvatar(user, userData);
    setupCallButtons();
  },
  onFailure: () => {
    window.location.href = 'login.html';
  }
});

function setupCallButtons() {
  document.querySelectorAll('.call-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      e.preventDefault();

      if (!currentUser) return;

      try {
        const userRef = doc(db, 'Users', currentUser.uid);

        await updateDoc(userRef, {
          totalCallsJoined: increment(1),
          lastCallJoinedAt: serverTimestamp()
        });

        const href = btn.getAttribute('href');

        if (href && href !== '#') {
          window.open(href, '_blank');
        } else {
          alert('âœ… Call recorded. Link coming soon.');
        }

      } catch (err) {
        console.error('Call tracking failed:', err);
        alert('âš ï¸ Could not record attendance.');
      }
    });
  });
}
</script>

</body>
</html>
