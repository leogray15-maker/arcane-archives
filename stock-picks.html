<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Private Stock List | The Arcane Archives</title>
  <link rel="icon" href="ArcaneA.png" />
  <style>
    :root {
      --bg-dark: #02010a;
      --purple: #9333ea;
      --purple-light: #a78bfa;
      --gold: #fbbf24;
      --text-light: #e5e5e5;
      --text-dim: #a3a3a3;
      --green: #22c55e;
      --red: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(circle at top, #111827 0, #02010a 45%, #000 100%);
      color: var(--text-light);
      min-height: 100vh;
    }

    .back-btn {
      position: fixed;
      top: 1.2rem;
      left: 1.2rem;
      z-index: 40;
      padding: 0.5rem 1.1rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      backdrop-filter: blur(12px);
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      color: var(--purple-light);
      border-color: rgba(147, 51, 234, 0.8);
      transform: translateX(-2px);
    }

    .header {
      max-width: 1200px;
      margin: 3rem auto 0;
      padding: 0 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.7rem;
      font-weight: 800;
      letter-spacing: 0.1em;
      font-size: 0.9rem;
    }

    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }

    .page-card {
      background: radial-gradient(circle at top, rgba(147, 51, 234, 0.18), rgba(15, 23, 42, 0.98));
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 30px 120px rgba(15, 23, 42, 0.85);
      padding: 2rem;
    }

    .page-header {
      margin-bottom: 2rem;
    }

    .page-header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .page-header h1 span {
      background: linear-gradient(135deg, var(--gold), var(--purple-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .page-header p {
      color: var(--text-dim);
      line-height: 1.7;
    }

    .disclaimer {
      background: rgba(251, 191, 36, 0.1);
      border: 1px dashed rgba(251, 191, 36, 0.35);
      border-radius: 12px;
      padding: 1.3rem;
      margin-bottom: 2rem;
      font-size: 0.9rem;
      color: var(--text-dim);
      line-height: 1.6;
    }

    .disclaimer strong {
      color: var(--gold);
    }

    .category {
      margin-bottom: 2.5rem;
    }

    .category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid rgba(148, 163, 184, 0.3);
    }

    .category-title {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .category-count {
      background: rgba(147, 51, 234, 0.2);
      color: var(--purple-light);
      padding: 0.3rem 0.8rem;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .stocks-grid {
      display: grid;
      gap: 1.2rem;
    }

    .stock-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.2s;
    }

    .stock-card:hover {
      border-color: var(--purple);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(147, 51, 234, 0.2);
    }

    .stock-main h3 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .ticker-pill {
      background: linear-gradient(135deg, var(--purple), var(--purple-dark));
      color: white;
      padding: 0.3rem 0.7rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    .stock-meta {
      color: var(--text-dim);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .stock-thesis {
      color: var(--text-light);
      line-height: 1.7;
      margin-bottom: 1rem;
    }

    .stock-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .tag {
      background: rgba(148, 163, 184, 0.2);
      color: var(--text-dim);
      padding: 0.3rem 0.7rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .tag.risk-low {
      background: rgba(34, 197, 94, 0.2);
      color: var(--green);
    }

    .tag.risk-medium {
      background: rgba(251, 191, 36, 0.2);
      color: var(--gold);
    }

    .tag.risk-high {
      background: rgba(239, 68, 68, 0.2);
      color: var(--red);
    }

    .stock-levels {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
    }

    .level-box {
      text-align: center;
    }

    .level-label {
      font-size: 0.75rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.3rem;
    }

    .level-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--purple-light);
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1.5rem;
      color: var(--text-dim);
      font-size: 0.95rem;
    }

    #loading {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-dim);
      font-size: 1.1rem;
    }

    @media (max-width: 768px) {
      .page-header h1 {
        font-size: 1.6rem;
      }

      .category-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }

      .stock-levels {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <a href="dashboard.html" class="back-btn">‚Üê Back</a>

  <div class="header">
    <div class="logo">THE ARCANE ARCHIVES</div>
  </div>

  <div class="main-content">
    <div class="page-card">
      <div class="page-header">
        <h1><span>üìà Private Stock List</span></h1>
        <p>Curated equity ideas for Arcane members. Updated regularly based on market conditions.</p>
      </div>

      <div class="disclaimer">
        <strong>Disclaimer:</strong> This page is for educational purposes only and is not personal investment advice. Nothing 
        here is an offer or solicitation to buy or sell any security. Markets carry risk ‚Äì including the risk of total 
        loss. Always do your own research, size appropriately, and speak to a qualified professional if needed.
      </div>

      <div id="loading">Loading stock picks...</div>

      <div id="stocksContent" style="display: none;">
        <div class="category">
          <div class="category-header">
            <div class="category-title">üéØ Core Holdings</div>
            <div class="category-count" id="coreCount">0</div>
          </div>
          <div class="stocks-grid" id="coreStocks"></div>
        </div>

        <div class="category">
          <div class="category-header">
            <div class="category-title">‚ö° Tactical Positions</div>
            <div class="category-count" id="tacticalCount">0</div>
          </div>
          <div class="stocks-grid" id="tacticalStocks"></div>
        </div>

        <div class="category">
          <div class="category-header">
            <div class="category-title">üëÄ Watchlist</div>
            <div class="category-count" id="watchlistCount">0</div>
          </div>
          <div class="stocks-grid" id="watchlistStocks"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { 
      getFirestore, 
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAK9MheMvSeOpscic4lXUsIwa0J5ubVf6w",
      authDomain: "arcane-archives-3b0f5.firebaseapp.com",
      projectId: "arcane-archives-3b0f5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      await loadStocks();
    });

    async function loadStocks() {
      try {
        // FIXED: No orderBy to avoid index requirement
        const snapshot = await getDocs(collection(db, 'StockPicks'));
        
        const coreStocks = [];
        const tacticalStocks = [];
        const watchlistStocks = [];

        snapshot.forEach((doc) => {
          const stock = { id: doc.id, ...doc.data() };
          if (stock.category === 'core') coreStocks.push(stock);
          else if (stock.category === 'tactical') tacticalStocks.push(stock);
          else if (stock.category === 'watchlist') watchlistStocks.push(stock);
        });

        // Sort manually by createdAt (newest first)
        const sortByDate = (a, b) => {
          const aTime = a.createdAt?.toMillis() || 0;
          const bTime = b.createdAt?.toMillis() || 0;
          return bTime - aTime;
        };

        coreStocks.sort(sortByDate);
        tacticalStocks.sort(sortByDate);
        watchlistStocks.sort(sortByDate);

        renderStocks('coreStocks', coreStocks, 'coreCount');
        renderStocks('tacticalStocks', tacticalStocks, 'tacticalCount');
        renderStocks('watchlistStocks', watchlistStocks, 'watchlistCount');

        document.getElementById('loading').style.display = 'none';
        document.getElementById('stocksContent').style.display = 'block';
      } catch (error) {
        console.error('Error loading stocks:', error);
        document.getElementById('loading').innerHTML = `
          <div style="color: var(--red);">
            Error loading stock picks. Please try again later.<br>
            <small style="color: var(--text-dim); margin-top: 0.5rem; display: block;">
              ${error.message}
            </small>
          </div>
        `;
      }
    }

    function renderStocks(containerId, stocks, countId) {
      const container = document.getElementById(containerId);
      const countEl = document.getElementById(countId);
      
      countEl.textContent = stocks.length;

      if (stocks.length === 0) {
        container.innerHTML = '<div class="empty-state">No stocks in this category yet</div>';
        return;
      }

      container.innerHTML = stocks.map(stock => `
        <div class="stock-card">
          <div class="stock-main">
            <h3>
              <span class="ticker-pill">${stock.ticker}</span>
              ${stock.companyName}
            </h3>
            <div class="stock-meta">
              ${stock.sector} ‚Ä¢ ${stock.region || 'N/A'}
            </div>
            <div class="stock-thesis">
              ${stock.thesis}
            </div>
            <div class="stock-tags">
              <span class="tag risk-${stock.riskLevel}">Risk: ${capitalizeFirst(stock.riskLevel)}</span>
              ${stock.timeframe ? `<span class="tag">${stock.timeframe}</span>` : ''}
              ${stock.conviction ? `<span class="tag">Conviction: ${stock.conviction}</span>` : ''}
            </div>
          </div>
          
          <div class="stock-levels">
            ${stock.entryLow || stock.entryHigh ? `
              <div class="level-box">
                <div class="level-label">Entry Zone</div>
                <div class="level-value">
                  ${formatPrice(stock.entryLow)} - ${formatPrice(stock.entryHigh)}
                </div>
              </div>
            ` : ''}
            
            ${stock.target1 || stock.target2 ? `
              <div class="level-box">
                <div class="level-label">Targets</div>
                <div class="level-value">
                  ${formatPrice(stock.target1)}${stock.target2 ? ` / ${formatPrice(stock.target2)}` : ''}
                </div>
              </div>
            ` : ''}
            
            ${stock.stopLoss ? `
              <div class="level-box">
                <div class="level-label">Hard Exit</div>
                <div class="level-value">${formatPrice(stock.stopLoss)}</div>
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');
    }

    function formatPrice(price) {
      if (!price) return 'N/A';
      return '$' + parseFloat(price).toFixed(2);
    }

    function capitalizeFirst(str) {
      if (!str) return '';
      return str.charAt(0).toUpperCase() + str.slice(1);
    }
  </script>
</body>
</html>