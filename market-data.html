<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Arcane Intelligence Terminal | The Arcane Archives</title>
  <link rel="icon" href="ArcaneA.png" />
  <link rel="apple-touch-icon" href="ArcaneA.png">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" />
  <style>
    :root {
      --bg:           #05050a;
      --bg-panel:     #0a0a12;
      --bg-card:      #0f0f18;
      --border:       rgba(100, 116, 139, 0.11);
      --gold:         #f59e0b;
      --purple:       #9333ea;
      --purple-light: #a78bfa;
      --green:        #10b981;
      --red:          #ef4444;
      --amber:        #f59e0b;
      --live:         #00ff88;
      --text:         #e2e8f0;
      --text-dim:     #64748b;
      --text-muted:   #273444;
      --mono:         'SF Mono','Monaco','Menlo','Consolas',monospace;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    html { scroll-behavior:smooth; }
    body {
      background:var(--bg); color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Inter','Segoe UI',sans-serif;
      -webkit-font-smoothing:antialiased; overflow-x:hidden;
    }

    /* â”€â”€ FIXED LAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       nav      48px + safe-area
       ticker   40px
       sessbar  34px
       tabs     44px
       total    166px + safe-area
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    nav {
      position:fixed; top:0; left:0; right:0; z-index:1000;
      height:calc(48px + env(safe-area-inset-top,0px));
      background:rgba(5,5,10,0.97);
      backdrop-filter:blur(24px) saturate(180%);
      -webkit-backdrop-filter:blur(24px) saturate(180%);
      border-bottom:1px solid var(--border);
    }
    .nav-inner {
      height:100%; padding:env(safe-area-inset-top,0px) 1.5rem 0;
      display:flex; align-items:center; justify-content:space-between; gap:1rem;
    }
    .nav-logo {
      font-size:.8125rem; font-weight:800;
      background:linear-gradient(135deg,var(--gold) 20%,var(--purple-light) 80%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      background-clip:text; text-decoration:none; letter-spacing:.07em; text-transform:uppercase;
      white-space:nowrap; flex-shrink:0;
    }
    .nav-live {
      display:flex; align-items:center; gap:.35rem;
      font-size:.625rem; font-weight:700; color:var(--live);
      text-transform:uppercase; letter-spacing:.14em;
      padding:.25rem .625rem; border:1px solid rgba(0,255,136,.2);
      border-radius:4px; background:rgba(0,255,136,.05);
    }
    .live-dot { width:5px; height:5px; border-radius:50%; background:var(--live); animation:pulseLive 1.4s infinite; }
    @keyframes pulseLive {
      0%,100%{ opacity:1; box-shadow:0 0 5px var(--live); }
      50%    { opacity:.4; box-shadow:none; }
    }
    .nav-btn {
      padding:.375rem .875rem; border:1px solid var(--border); border-radius:6px;
      background:var(--bg-card); color:var(--text-dim); text-decoration:none;
      font-size:.75rem; font-weight:600; transition:all .18s; white-space:nowrap;
    }
    .nav-btn:hover { border-color:var(--purple); color:var(--purple-light); }

    .sess-bar {
      position:fixed; top:calc(48px + env(safe-area-inset-top,0px));
      left:0; right:0; z-index:998; height:34px;
      background:rgba(5,5,10,.99); border-bottom:1px solid rgba(100,116,139,.05);
      display:flex; align-items:center; gap:.25rem; padding:0 1rem;
      overflow-x:auto; scrollbar-width:none;
    }
    .sess-bar::-webkit-scrollbar{ display:none; }
    .sess-chip {
      display:flex; align-items:center; gap:.3rem; padding:.175rem .575rem;
      border-radius:4px; border:1px solid transparent; font-size:.625rem; font-weight:700;
      white-space:nowrap; flex-shrink:0; font-variant-numeric:tabular-nums;
      font-family:var(--mono); letter-spacing:.03em;
    }
    .sess-chip.open   { background:rgba(16,185,129,.07); border-color:rgba(16,185,129,.22); color:var(--green); }
    .sess-chip.pre    { background:rgba(245,158,11,.07); border-color:rgba(245,158,11,.22);  color:var(--amber); }
    .sess-chip.closed { background:rgba(100,116,139,.04); border-color:rgba(100,116,139,.07); color:var(--text-muted); }
    .sess-dot { width:5px; height:5px; border-radius:50%; background:currentColor; }
    .sess-chip.open .sess-dot { animation:pulseLive 1.4s infinite; }

    .sec-tabs {
      position:fixed; top:calc(82px + env(safe-area-inset-top,0px));
      left:0; right:0; z-index:997; height:44px;
      background:rgba(5,5,10,.99); border-bottom:1px solid rgba(100,116,139,.09);
      display:flex; align-items:center; gap:.25rem; padding:0 1rem;
      overflow-x:auto; scrollbar-width:none;
    }
    .sec-tabs::-webkit-scrollbar{ display:none; }
    .tab-btn {
      display:flex; align-items:center; gap:.35rem; padding:.35rem .875rem;
      border:1px solid transparent; border-radius:6px; background:transparent;
      color:var(--text-dim); font-size:.6875rem; font-weight:700; text-transform:uppercase;
      letter-spacing:.07em; cursor:pointer; white-space:nowrap; flex-shrink:0;
      transition:all .18s; font-family:inherit;
    }
    .tab-btn:hover { color:var(--text); background:rgba(255,255,255,.03); }
    .tab-btn.active { background:rgba(147,51,234,.1); border-color:rgba(147,51,234,.28); color:var(--purple-light); }
    .tab-icon{ font-size:.8rem; }
    .tabs-div{ width:1px; height:18px; background:var(--border); flex-shrink:0; margin:0 .125rem; }
    .tabs-right{ margin-left:auto; display:flex; align-items:center; gap:.5rem; flex-shrink:0; }
    .utc-clock{ font-size:.6875rem; font-family:var(--mono); font-variant-numeric:tabular-nums; color:var(--text-dim); white-space:nowrap; }

    /* â”€â”€ MAIN â”€â”€ */
    main { padding-top:calc(126px + env(safe-area-inset-top,0px)); padding-bottom:4rem; }
    .page-section { padding:1.5rem 1rem 0; scroll-margin-top:calc(126px + env(safe-area-inset-top,0px)); }

    /* SECTION HEADER */
    .s-hdr { display:flex; align-items:center; gap:.75rem; margin-bottom:1rem; padding-bottom:.75rem; border-bottom:1px solid var(--border); }
    .s-hdr-icon{ font-size:1rem; }
    .s-hdr-text{ flex:1; }
    .s-hdr-title{ font-size:.875rem; font-weight:800; color:var(--text); text-transform:uppercase; letter-spacing:.08em; }
    .s-hdr-sub{ font-size:.6rem; color:var(--text-dim); margin-top:.1rem; letter-spacing:.05em; text-transform:uppercase; }
    .s-hdr-badges{ display:flex; align-items:center; gap:.375rem; }
    .badge{ font-size:.575rem; font-weight:700; padding:.175rem .45rem; border-radius:3px; text-transform:uppercase; letter-spacing:.08em; white-space:nowrap; }
    .b-live{ background:rgba(0,255,136,.08); border:1px solid rgba(0,255,136,.22); color:var(--live); }
    .b-ai  { background:rgba(147,51,234,.08); border:1px solid rgba(147,51,234,.22); color:var(--purple-light); }
    .b-hi  { background:rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.22); color:var(--gold); }
    .b-red { background:rgba(239,68,68,.08);  border:1px solid rgba(239,68,68,.22);  color:#ef4444; }
    .b-live::before{ content:'â— '; font-size:.45rem; }

    /* GRIDS */
    .g2  { display:grid; grid-template-columns:1fr 1fr; gap:.75rem; }
    .g3  { display:grid; grid-template-columns:1fr 1fr 1fr; gap:.75rem; }
    .g5  { display:grid; grid-template-columns:repeat(5,1fr); gap:.625rem; }
    .g-com{ display:grid; grid-template-columns:repeat(3,1fr); gap:.625rem; }
    .mb  { margin-bottom:.75rem; }

    /* HERO CARDS */
    .hero-card {
      background:var(--bg-panel); border:1px solid var(--border); border-radius:10px;
      padding:.875rem 1rem .5rem; position:relative; overflow:hidden; transition:border-color .2s,box-shadow .2s;
    }
    .hero-card::after{ content:''; position:absolute; inset:0; background:linear-gradient(135deg,transparent 60%,rgba(147,51,234,.04)); pointer-events:none; }
    .hero-card:hover{ border-color:rgba(147,51,234,.35); box-shadow:0 0 24px rgba(147,51,234,.07); }
    .hero-label{ font-size:.6rem; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--text-dim); margin-bottom:.25rem; }

    /* PANEL */
    .panel{ background:var(--bg-panel); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
    .panel-hdr{ padding:.75rem 1rem; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,.01); }
    .p-title{ font-size:.7rem; font-weight:700; color:var(--text); text-transform:uppercase; letter-spacing:.07em; display:flex; align-items:center; gap:.4rem; }
    .p-sub{ font-size:.575rem; color:var(--text-dim); margin-top:.1rem; text-transform:uppercase; letter-spacing:.05em; }
    .panel-body{ padding:.875rem; }

    /* SESSIONS */
    .sess-list{ display:flex; flex-direction:column; gap:.375rem; }
    .sess-row{ display:grid; grid-template-columns:1.25rem 2.75rem 1fr auto; align-items:center; gap:.5rem; padding:.4rem .6rem; border-radius:6px; border:1px solid transparent; transition:all .2s; }
    .sess-row.open  { background:rgba(16,185,129,.05); border-color:rgba(16,185,129,.13); }
    .sess-row.pre   { background:rgba(245,158,11,.05);  border-color:rgba(245,158,11,.13); }
    .sess-row.closed{ background:rgba(100,116,139,.02); border-color:rgba(100,116,139,.05); opacity:.5; }
    .sr-flag{ font-size:.875rem; }
    .sr-name{ font-size:.675rem; font-weight:700; font-family:var(--mono); }
    .sr-city{ font-size:.575rem; color:var(--text-dim); }
    .sr-time{ font-size:.6rem; color:var(--text-dim); font-family:var(--mono); font-variant-numeric:tabular-nums; }
    .sr-status{ font-size:.55rem; font-weight:700; padding:.125rem .35rem; border-radius:3px; text-transform:uppercase; letter-spacing:.06em; }
    .st-open  { background:rgba(16,185,129,.12); border:1px solid rgba(16,185,129,.28); color:var(--green); }
    .st-pre   { background:rgba(245,158,11,.12);  border:1px solid rgba(245,158,11,.28);  color:var(--amber); }
    .st-closed{ background:rgba(100,116,139,.08); border:1px solid rgba(100,116,139,.1);  color:var(--text-dim); }

    /* FEAR & GREED */
    .fg-wrap{ display:flex; flex-direction:column; align-items:center; }
    .fg-gauge{ position:relative; width:180px; height:100px; margin-bottom:.375rem; }
    .fg-gauge svg{ width:180px; height:100px; }
    .fg-score-pos{ position:absolute; bottom:-4px; left:50%; transform:translateX(-50%); text-align:center; }
    .fg-num{ font-size:2.125rem; font-weight:900; font-variant-numeric:tabular-nums; line-height:1; }
    .fg-lbl{ font-size:.65rem; font-weight:700; text-transform:uppercase; letter-spacing:.1em; text-align:center; margin-bottom:.875rem; margin-top:.375rem; }
    .fg-bands{ display:grid; grid-template-columns:repeat(5,1fr); gap:.2rem; width:100%; }
    .fg-band{ text-align:center; padding:.25rem .1rem; border-radius:4px; font-size:.5rem; font-weight:700; text-transform:uppercase; letter-spacing:.04em; border:1px solid transparent; line-height:1.3; transition:box-shadow .3s; }
    .fg-band.active{ box-shadow:0 0 8px currentColor; }

    /* CRYPTO */
    .cg2{ display:grid; grid-template-columns:1fr 1fr; gap:.5rem; }
    .c-metric{ background:var(--bg-card); border:1px solid var(--border); border-radius:8px; padding:.6rem; }
    .cm-lbl{ font-size:.55rem; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--text-dim); margin-bottom:.25rem; }
    .cm-val{ font-size:.9375rem; font-weight:700; font-variant-numeric:tabular-nums; color:var(--text); line-height:1; }
    .cm-chg{ font-size:.575rem; font-weight:600; margin-top:.175rem; font-variant-numeric:tabular-nums; }
    .dom-block{ margin-top:.75rem; padding-top:.75rem; border-top:1px solid var(--border); }
    .dom-row{ margin-bottom:.425rem; }
    .dom-lbl{ display:flex; justify-content:space-between; font-size:.575rem; color:var(--text-dim); margin-bottom:.225rem; }
    .dom-val{ font-weight:700; }
    .dom-track{ height:5px; background:rgba(100,116,139,.1); border-radius:3px; overflow:hidden; }
    .dom-fill{ height:100%; border-radius:3px; transition:width 1.2s ease; }

    /* CURRENCY STRENGTH */
    .cur-list{ display:flex; flex-direction:column; gap:.425rem; }
    .cur-row { display:grid; grid-template-columns:3.25rem 1fr 3rem; align-items:center; gap:.5rem; }
    .cur-code{ font-size:.675rem; font-weight:700; font-family:var(--mono); }
    .bar-track{ height:5px; background:rgba(100,116,139,.1); border-radius:3px; overflow:hidden; }
    .bar-fill { height:100%; border-radius:3px; transition:width .9s ease; }
    .cur-val  { font-size:.6rem; font-family:var(--mono); font-variant-numeric:tabular-nums; text-align:right; }

    /* RISK MONITOR */
    .risk-row{ display:grid; grid-template-columns:1fr auto; align-items:center; gap:.625rem; padding:.5rem .625rem; border-radius:7px; background:var(--bg-card); border:1px solid var(--border); }
    .r-lbl { font-size:.675rem; font-weight:700; color:var(--text); }
    .r-desc{ font-size:.575rem; color:var(--text-dim); margin-top:.1rem; }
    .r-right{ display:flex; flex-direction:column; align-items:flex-end; gap:.225rem; }
    .r-lvl { font-size:.575rem; font-weight:700; text-transform:uppercase; letter-spacing:.06em; }
    .r-dots{ display:flex; gap:3px; }
    .r-dot { width:7px; height:7px; border-radius:50%; }
    .r-dot.on { background:currentColor; }
    .r-dot.off{ background:rgba(100,116,139,.14); }

    /* TV WRAP */
    .tv-wrap{ background:var(--bg-panel); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
    .tv-hdr{ padding:.75rem 1rem; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,.01); }
    .tradingview-widget-container { width:100%; height:100%; }
    .tradingview-widget-container__widget { width:100%; height:100%; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GEO MAP â€” GLOBAL SITUATION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .geo-wrap{
      border:1px solid var(--border); border-radius:12px;
      overflow:hidden; display:grid;
      grid-template-columns:1fr 272px;
      height:580px; /* fixed height â€” prevents blank space below map */
    }
    .geo-map-col{ position:relative; display:flex; flex-direction:column; }
    .geo-toolbar{
      display:flex; align-items:center; gap:.35rem;
      padding:.55rem .875rem; background:rgba(5,5,10,.97);
      border-bottom:1px solid var(--border); overflow-x:auto;
      scrollbar-width:none; flex-shrink:0;
    }
    .geo-toolbar::-webkit-scrollbar{ display:none; }
    .geo-tlabel{ font-size:.55rem; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--text-muted); flex-shrink:0; margin-right:.2rem; }
    .geo-btn{
      display:flex; align-items:center; gap:.25rem;
      padding:.2rem .55rem; border:1px solid var(--border); border-radius:4px;
      background:transparent; color:var(--text-dim); font-size:.6rem; font-weight:700;
      cursor:pointer; white-space:nowrap; flex-shrink:0; transition:all .15s; font-family:inherit;
    }
    .geo-btn:hover{ color:var(--text); border-color:rgba(100,116,139,.3); }
    .geo-btn.active{ background:rgba(147,51,234,.1); border-color:rgba(147,51,234,.3); color:var(--purple-light); }
    #geoMap{ flex:1; min-height:480px; background:var(--bg); }

    /* Sidebar */
    .geo-side{
      background:var(--bg-panel); border-left:1px solid var(--border);
      display:flex; flex-direction:column; overflow:hidden;
    }
    /* Stats block â€” always visible at top of sidebar */
    .geo-stats-wrap{
      flex-shrink:0; padding:.55rem .6rem .45rem;
      border-bottom:1px solid var(--border);
    }
    /* Risk stats row */
    .geo-stats{ display:grid; grid-template-columns:repeat(4,1fr); gap:.3rem; }

    /* Sidebar tabs */
    .geo-side-tabs{
      display:flex; flex-shrink:0; overflow-x:auto; scrollbar-width:none;
      border-bottom:1px solid var(--border); background:rgba(5,5,10,.5);
    }
    .geo-side-tabs::-webkit-scrollbar{ display:none; }
    .geo-side-tab-btn{
      flex:1; min-width:0; padding:.425rem .2rem;
      font-size:.475rem; font-weight:700; text-align:center; line-height:1.2;
      color:var(--text-dim); cursor:pointer;
      border:none; border-bottom:2px solid transparent;
      background:transparent; font-family:inherit;
      text-transform:uppercase; letter-spacing:.04em;
      white-space:nowrap; transition:all .15s;
    }
    .geo-side-tab-btn:hover{ color:var(--text); background:rgba(255,255,255,.02); }
    .geo-side-tab-btn.stab-active{ color:var(--purple-light); border-bottom-color:var(--purple); background:rgba(147,51,234,.07); }

    /* Scrollable content area */
    .geo-side-content{
      flex:1; min-height:0; overflow-y:auto; overflow-x:hidden;
      padding:.45rem .575rem .75rem;
      scrollbar-width:thin; scrollbar-color:rgba(100,116,139,.2) transparent;
    }
    .geo-side-content::-webkit-scrollbar{ width:3px; }
    .geo-side-content::-webkit-scrollbar-track{ background:transparent; }
    .geo-side-content::-webkit-scrollbar-thumb{ background:rgba(100,116,139,.2); border-radius:2px; }

    /* Tab panes â€” only active is shown */
    .geo-tab-pane{ display:none; }
    .geo-tab-pane.stab-active{ display:block; }
    .geo-stat{ background:var(--bg-card); border:1px solid var(--border); border-radius:6px; padding:.45rem .375rem; text-align:center; }
    .geo-stat-lbl{ font-size:.5rem; font-weight:700; text-transform:uppercase; letter-spacing:.08em; color:var(--text-dim); margin-bottom:.2rem; }
    .geo-stat-val{ font-size:1.375rem; font-weight:900; line-height:1; }

    .geo-group-title{ font-size:.575rem; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--text-dim); margin-bottom:.4rem; margin-top:.625rem; padding-bottom:.25rem; border-bottom:1px solid rgba(100,116,139,.08); }
    .geo-group-title:first-child{ margin-top:0; }

    .geo-event{
      padding:.4rem .5rem; border-radius:5px; border:1px solid transparent;
      margin-bottom:.275rem; cursor:pointer; transition:all .15s;
    }
    .geo-event:hover{ filter:brightness(1.2); }
    .geo-event.critical{ background:rgba(239,68,68,.05); border-color:rgba(239,68,68,.14); }
    .geo-event.high    { background:rgba(249,115,22,.05); border-color:rgba(249,115,22,.13); }
    .geo-event.elevated{ background:rgba(245,158,11,.04); border-color:rgba(245,158,11,.11); }
    .geo-event.neutral { background:rgba(100,116,139,.04); border-color:rgba(100,116,139,.09); }
    .geo-evname{ font-size:.65rem; font-weight:700; color:var(--text); display:flex; justify-content:space-between; align-items:center; }
    .geo-evdesc{ font-size:.575rem; color:var(--text-dim); margin-top:.1rem; }
    .sev-badge{ font-size:.5rem; font-weight:700; padding:.1rem .3rem; border-radius:2px; text-transform:uppercase; flex-shrink:0; }
    .sev-crit{ background:rgba(239,68,68,.18); color:#ef4444; }
    .sev-high{ background:rgba(249,115,22,.18); color:#f97316; }
    .sev-elev{ background:rgba(245,158,11,.18); color:#f59e0b; }
    .sev-low { background:rgba(100,116,139,.18); color:#94a3b8; }
    .geo-live-ct{ display:inline-block; margin-left:.25rem; font-size:.45rem; font-weight:700; background:rgba(0,255,136,.12); color:var(--live); border-radius:3px; padding:.05rem .25rem; vertical-align:middle; line-height:1.4; }

    /* â”€â”€ Intel ticker bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .geo-intel-bar{
      flex-shrink:0; height:22px;
      background:rgba(5,5,10,.96); border-top:1px solid rgba(100,116,139,.1);
      display:flex; align-items:center; overflow:hidden;
    }
    .geo-intel-label{
      flex-shrink:0; padding:0 .5rem;
      font-size:.48rem; font-weight:800; letter-spacing:.12em;
      text-transform:uppercase; color:var(--live); white-space:nowrap;
      font-family:var(--mono); border-right:1px solid rgba(100,116,139,.12);
    }
    .geo-intel-wrap{ flex:1; overflow:hidden; }
    .geo-intel-ticker{
      display:inline-block; white-space:nowrap; padding-left:1rem;
      font-size:.48rem; color:rgba(148,163,184,.7); font-family:var(--mono);
      animation:tickerScroll 80s linear infinite;
    }
    @keyframes tickerScroll{
      0%  { transform:translateX(0); }
      100%{ transform:translateX(-50%); }
    }

    /* Leaflet popup override */
    .leaflet-popup-content-wrapper{
      background:rgba(10,10,18,.97) !important;
      border:1px solid rgba(100,116,139,.2) !important;
      border-radius:8px !important;
      box-shadow:0 8px 32px rgba(0,0,0,.5) !important;
      padding:0 !important;
    }
    .leaflet-popup-content{ margin:0 !important; }
    .leaflet-popup-tip-container{ display:none !important; }
    .geo-popup-inner{ padding:.625rem .75rem; }
    .geo-popup-title{ font-size:.75rem; font-weight:700; margin-bottom:.2rem; font-family:sans-serif; }
    .geo-popup-desc{ font-size:.65rem; color:#94a3b8; font-family:sans-serif; }
    .geo-popup-sev{ display:inline-block; margin-top:.3rem; font-size:.55rem; font-weight:700; padding:.1rem .35rem; border-radius:3px; text-transform:uppercase; }

    @keyframes pulseMap{
      0%  { transform:scale(1); opacity:1; }
      50% { transform:scale(1.6); opacity:.5; }
      100%{ transform:scale(1); opacity:1; }
    }
    @keyframes pulseRing{
      0%  { transform:scale(1); opacity:.8; }
      100%{ transform:scale(2.5); opacity:0; }
    }

    /* UTILS */
    .up   { color:var(--green); }
    .down { color:var(--red); }
    .shimmer{ background:linear-gradient(90deg,var(--bg-card) 25%,rgba(255,255,255,.02) 50%,var(--bg-card) 75%); background-size:200% 100%; animation:shimmer 1.5s infinite; border-radius:4px; }
    @keyframes shimmer{ 0%{ background-position:200% 0; } 100%{ background-position:-200% 0; } }
    .panel-note{ font-size:.55rem; color:var(--text-muted); border-top:1px solid var(--border); padding-top:.5rem; margin-top:.625rem; }

    /* RESPONSIVE */
    @media (max-width:1280px){ .g5,.g-com{ grid-template-columns:repeat(3,1fr); } }
    @media (max-width:1024px){
      .g3{ grid-template-columns:1fr 1fr; }
      .geo-wrap{ grid-template-columns:1fr; height:auto; }
      .geo-side{ border-left:none; border-top:1px solid var(--border); max-height:360px; }
      .geo-stats{ grid-template-columns:repeat(4,1fr); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MOBILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width:768px){
      /* â”€â”€ Compressed fixed header stack â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      nav{
        height:calc(44px + env(safe-area-inset-top,0px));
      }
      .nav-inner{
        padding:env(safe-area-inset-top,0px) .875rem 0;
        gap:.5rem;
      }
      .nav-logo{ font-size:.7rem; letter-spacing:.05em; }
      .nav-live{ display:none; }
      .nav-btn{ font-size:.65rem; padding:.3rem .6rem; white-space:nowrap; }

      /* Session bar hidden on mobile â€” sessions visible in panel below */
      .sess-bar{ display:none; }

      /* Section tabs â€” sit directly below nav, icon-only */
      /* nav=44px, tabs=40px â†’ total 84px */
      .sec-tabs{
        top:calc(44px + env(safe-area-inset-top,0px));
        height:40px;
        padding:0 .375rem;
        gap:.125rem;
      }
      .tab-text{ display:none; }
      .tab-btn{ padding:.35rem .6rem; gap:0; }
      .tab-icon{ font-size:.9rem; }
      .tabs-right,.tabs-div{ display:none; }

      /* Main offset â€” 44px nav + 40px tabs = 84px */
      main{
        padding-top:calc(84px + env(safe-area-inset-top,0px));
        padding-bottom:calc(2.5rem + env(safe-area-inset-bottom,0px));
      }
      .page-section{
        padding-left:.625rem;
        padding-right:.625rem;
        scroll-margin-top:calc(84px + env(safe-area-inset-top,0px));
      }

      /* â”€â”€ Hero stats: horizontal swipe strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .g5{
        display:flex; gap:.5rem;
        overflow-x:auto; -webkit-overflow-scrolling:touch;
        scrollbar-width:none; padding-bottom:.375rem;
      }
      .g5::-webkit-scrollbar{ display:none; }
      /* 168px gives TradingView widget ~136px content width â€” enough to render price */
      .g5 .hero-card{ min-width:168px; flex-shrink:0; padding:.75rem .875rem .4rem; }

      /* â”€â”€ Grids â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .g3,.g-com{ grid-template-columns:1fr 1fr; }
      .g2{ grid-template-columns:1fr; }

      /* â”€â”€ Section headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .s-hdr-sub{ display:none; }
      .s-hdr{ margin-bottom:.625rem; padding-bottom:.5rem; }
      .s-hdr-badges .badge{ font-size:.5rem; }

      /* â”€â”€ Geo map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      #geoMap{ min-height:320px; }
      .geo-stats{ grid-template-columns:repeat(2,1fr); }
      .geo-toolbar{ padding:.375rem .5rem; gap:.25rem; }
      .geo-tlabel{ display:none; }
      .geo-stat-val{ font-size:1.125rem; }
      /*
        ROOT CAUSE: .geo-wrap overflow:hidden + border-radius:12px corner-clips
        content at the bottom-right zone. Items near the bottom of the sidebar
        lose their right-side badge to the radius curve.
        FIX: strip overflow+border from parent, give each child its own rounding.
      */
      .geo-wrap{ overflow:visible; border:none; border-radius:0; height:auto; }
      .geo-map-col{
        border:1px solid var(--border); border-bottom:none;
        border-radius:12px 12px 0 0; overflow:hidden;
      }
      .geo-side{
        border:1px solid var(--border); border-top:none;
        border-radius:0 0 12px 12px; overflow:hidden;
        max-height:400px;
      }
      .geo-stats-wrap{ padding:.45rem .5rem .35rem; }
      .geo-side-content{
        overflow-y:auto; overflow-x:hidden;
        padding:.4rem .5rem 1.5rem;
      }
      .geo-side-tab-btn{ font-size:.45rem; padding:.38rem .15rem; }
      .geo-event{ padding:.45rem .5rem; }
      .geo-evname{ font-size:.675rem; gap:.375rem; flex-wrap:nowrap; }
      .sev-badge{ flex-shrink:0; white-space:nowrap; }
      .geo-evdesc{ font-size:.6rem; }

      /* â”€â”€ Macro risk grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      #riskPanel{ grid-template-columns:1fr 1fr !important; gap:.375rem !important; }

      /* â”€â”€ Panel spacing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .panel-body{ padding:.625rem; }
      .panel-hdr{ padding:.5rem .75rem; }
      .p-title{ font-size:.65rem; }

      /* â”€â”€ Fear & Greed gauge scale â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .fg-gauge{ width:150px; height:83px; }
      .fg-gauge svg{ width:150px; height:83px; }
      .fg-num{ font-size:1.75rem; }
      .fg-bands{ gap:.125rem; }
      .fg-band{ font-size:.475rem; padding:.2rem .05rem; }
      .fg-lbl{ font-size:.6rem; }

      /* â”€â”€ Crypto panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .cm-val{ font-size:.875rem; }

      /* â”€â”€ TV widget height overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .tv-body-560{ height:360px !important; }
      .tv-body-500{ height:340px !important; }
      .tv-body-440{ height:320px !important; }
      .tv-body-420{ height:300px !important; }
      .tv-body-600{ height:420px !important; }
      .tv-body-620{ height:440px !important; }
    }

    @media (max-width:480px){
      .g2,.g3{ grid-template-columns:1fr; }
      .g-com{ grid-template-columns:1fr 1fr; }
      #riskPanel{ grid-template-columns:1fr !important; }
      .s-hdr-title{ font-size:.8rem; }
      .hero-card{ padding:.75rem .875rem .4rem; }
      .geo-stat-lbl{ font-size:.45rem; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-inner">
    <a href="dashboard.html" class="nav-logo">â¬¡ Arcane Archives</a>
    <div class="nav-live"><div class="live-dot"></div>Intelligence Terminal</div>
    <a href="alerts.html" class="nav-btn">â† Trading Floor</a>
  </div>
</nav>

<!-- SESSION BAR -->
<div class="sess-bar" id="sessBar"></div>

<!-- SECTION TABS -->
<div class="sec-tabs">
  <button class="tab-btn active" data-tab="overview"    onclick="jumpTo('overview')"><span class="tab-icon">âš¡</span><span class="tab-text">Overview</span></button>
  <button class="tab-btn"        data-tab="global"      onclick="jumpTo('global')"><span class="tab-icon">ğŸŒ</span><span class="tab-text">Global</span></button>
  <button class="tab-btn"        data-tab="markets"     onclick="jumpTo('markets')"><span class="tab-icon">ğŸ“ˆ</span><span class="tab-text">Markets</span></button>
  <button class="tab-btn"        data-tab="forex"       onclick="jumpTo('forex')"><span class="tab-icon">ğŸ’±</span><span class="tab-text">Forex</span></button>
  <button class="tab-btn"        data-tab="commodities" onclick="jumpTo('commodities')"><span class="tab-icon">ğŸ…</span><span class="tab-text">Commodities</span></button>
  <button class="tab-btn"        data-tab="crypto"      onclick="jumpTo('crypto')"><span class="tab-icon">â‚¿</span><span class="tab-text">Crypto</span></button>
  <button class="tab-btn"        data-tab="calendar"    onclick="jumpTo('calendar')"><span class="tab-icon">ğŸ“…</span><span class="tab-text">Calendar</span></button>
  <div class="tabs-div"></div>
  <div class="tabs-right"><div class="utc-clock" id="utcClock">--:--:-- UTC</div></div>
</div>

<main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       1 Â· OVERVIEW
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="overview">
    <div class="s-hdr">
      <span class="s-hdr-icon">âš¡</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Command Center</div>
        <div class="s-hdr-sub">Global snapshot Â· Live sessions Â· Sentiment Â· Crypto intelligence</div>
      </div>
      <div class="s-hdr-badges"><span class="badge b-live">Live</span></div>
    </div>

    <!-- Hero Stats â€” 5 reliable symbols -->
    <div class="g5 mb">
      <div class="hero-card">
        <div class="hero-label">ğŸ“ˆ S&P 500</div>
        <div class="tradingview-widget-container" style="height:88px;min-height:unset;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {"symbol":"OANDA:SPX500USD","width":"100%","height":"88","isTransparent":true,"colorTheme":"dark","locale":"en"}
          </script>
        </div>
      </div>
      <div class="hero-card">
        <div class="hero-label">ğŸ’» Nasdaq 100</div>
        <div class="tradingview-widget-container" style="height:88px;min-height:unset;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {"symbol":"OANDA:NAS100USD","width":"100%","height":"88","isTransparent":true,"colorTheme":"dark","locale":"en"}
          </script>
        </div>
      </div>
      <div class="hero-card">
        <div class="hero-label">ğŸ¥‡ Gold</div>
        <div class="tradingview-widget-container" style="height:88px;min-height:unset;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {"symbol":"OANDA:XAUUSD","width":"100%","height":"88","isTransparent":true,"colorTheme":"dark","locale":"en"}
          </script>
        </div>
      </div>
      <div class="hero-card">
        <div class="hero-label">â‚¿ Bitcoin</div>
        <div class="tradingview-widget-container" style="height:88px;min-height:unset;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {"symbol":"BINANCE:BTCUSDT","width":"100%","height":"88","isTransparent":true,"colorTheme":"dark","locale":"en"}
          </script>
        </div>
      </div>
      <div class="hero-card">
        <div class="hero-label">ğŸ’± EUR / USD</div>
        <div class="tradingview-widget-container" style="height:88px;min-height:unset;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>
          {"symbol":"FX:EURUSD","width":"100%","height":"88","isTransparent":true,"colorTheme":"dark","locale":"en"}
          </script>
        </div>
      </div>
    </div>

    <!-- Sessions Â· Sentiment Â· Crypto -->
    <div class="g3">
      <div class="panel">
        <div class="panel-hdr">
          <div><div class="p-title">ğŸŒ Market Sessions</div><div class="p-sub">Live exchange hours</div></div>
          <span class="badge b-live">Live</span>
        </div>
        <div class="panel-body">
          <div class="sess-list" id="sessPanel"></div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-hdr">
          <div><div class="p-title">ğŸ§  Market Sentiment</div><div class="p-sub">Fear &amp; Greed Â· Alternative.me</div></div>
          <span class="badge b-live">Live</span>
        </div>
        <div class="panel-body">
          <div class="fg-wrap">
            <div class="fg-gauge">
              <svg viewBox="0 0 180 100">
                <defs>
                  <linearGradient id="arcGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%"   stop-color="#ef4444"/>
                    <stop offset="25%"  stop-color="#f97316"/>
                    <stop offset="50%"  stop-color="#eab308"/>
                    <stop offset="75%"  stop-color="#84cc16"/>
                    <stop offset="100%" stop-color="#10b981"/>
                  </linearGradient>
                </defs>
                <path d="M 14 90 A 76 76 0 0 1 166 90" fill="none" stroke="rgba(100,116,139,0.1)" stroke-width="13" stroke-linecap="round"/>
                <path id="fgArc" d="M 14 90 A 76 76 0 0 1 166 90" fill="none" stroke="url(#arcGrad)" stroke-width="13" stroke-linecap="round" stroke-dasharray="239" stroke-dashoffset="239"/>
                <text x="8"   y="100" fill="#ef4444" font-size="7.5" font-weight="700" font-family="sans-serif">FEAR</text>
                <text x="143" y="100" fill="#10b981" font-size="7.5" font-weight="700" font-family="sans-serif">GREED</text>
                <g id="fgNeedle" style="transform-origin:90px 90px;transform:rotate(-90deg);transition:transform 1.5s cubic-bezier(.34,1.56,.64,1);">
                  <line x1="90" y1="90" x2="90" y2="23" stroke="white" stroke-width="2" stroke-linecap="round" opacity=".85"/>
                  <circle cx="90" cy="90" r="4.5" fill="white" opacity=".9"/>
                  <circle cx="90" cy="90" r="2" fill="#05050a"/>
                </g>
              </svg>
              <div class="fg-score-pos"><div class="fg-num" id="fgNum" style="color:#eab308">--</div></div>
            </div>
            <div class="fg-lbl" id="fgLbl" style="color:#eab308">Loading...</div>
            <div class="fg-bands">
              <div class="fg-band" id="fgb0" style="background:rgba(239,68,68,.07);border-color:rgba(239,68,68,.22);color:#ef4444;">Extreme<br>Fear</div>
              <div class="fg-band" id="fgb1" style="background:rgba(249,115,22,.07);border-color:rgba(249,115,22,.22);color:#f97316;">Fear</div>
              <div class="fg-band" id="fgb2" style="background:rgba(234,179,8,.07);border-color:rgba(234,179,8,.22);color:#eab308;">Neutral</div>
              <div class="fg-band" id="fgb3" style="background:rgba(132,204,22,.07);border-color:rgba(132,204,22,.22);color:#84cc16;">Greed</div>
              <div class="fg-band" id="fgb4" style="background:rgba(16,185,129,.07);border-color:rgba(16,185,129,.22);color:#10b981;">Extreme<br>Greed</div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-hdr">
          <div><div class="p-title">â‚¿ Crypto Intelligence</div><div class="p-sub">Global crypto market Â· CoinGecko</div></div>
          <span class="badge b-live">Live</span>
        </div>
        <div class="panel-body">
          <div class="cg2">
            <div class="c-metric">
              <div class="cm-lbl">BTC Price</div>
              <div class="cm-val shimmer" id="btcP" style="min-height:1rem;width:80px;">&nbsp;</div>
              <div class="cm-chg" id="btcC"></div>
            </div>
            <div class="c-metric">
              <div class="cm-lbl">ETH Price</div>
              <div class="cm-val shimmer" id="ethP" style="min-height:1rem;width:80px;">&nbsp;</div>
              <div class="cm-chg" id="ethC"></div>
            </div>
            <div class="c-metric">
              <div class="cm-lbl">Total Mkt Cap</div>
              <div class="cm-val shimmer" id="mktC" style="min-height:1rem;width:60px;">&nbsp;</div>
              <div class="cm-chg" id="mktCC"></div>
            </div>
            <div class="c-metric">
              <div class="cm-lbl">24H Volume</div>
              <div class="cm-val shimmer" id="vol" style="min-height:1rem;width:60px;">&nbsp;</div>
              <div class="cm-chg" style="color:var(--text-dim)">Global crypto</div>
            </div>
          </div>
          <div class="dom-block">
            <div class="dom-row">
              <div class="dom-lbl"><span>BTC Dominance</span><span class="dom-val" id="btcD" style="color:var(--gold)">--%</span></div>
              <div class="dom-track"><div class="dom-fill" id="btcDB" style="width:0%;background:linear-gradient(90deg,#d97706,#f59e0b);"></div></div>
            </div>
            <div class="dom-row">
              <div class="dom-lbl"><span>ETH Dominance</span><span class="dom-val" id="ethD" style="color:var(--purple-light)">--%</span></div>
              <div class="dom-track"><div class="dom-fill" id="ethDB" style="width:0%;background:linear-gradient(90deg,#7c3aed,#a78bfa);"></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       2 Â· GLOBAL SITUATION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="global">
    <div class="s-hdr">
      <span class="s-hdr-icon">ğŸŒ</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Global Situation</div>
        <div class="s-hdr-sub">Live intelligence Â· Active conflicts Â· Seismic Â· Flights Â· Natural hazards Â· Energy choke points</div>
      </div>
      <div class="s-hdr-badges">
        <span class="badge b-red" id="globalRiskBadge">â–² CRITICAL RISK</span>
        <span class="badge" style="background:rgba(0,255,136,.06);border-color:rgba(0,255,136,.2);color:var(--live);font-size:.5rem">4 LIVE FEEDS</span>
        <span class="badge b-live">Live</span>
      </div>
    </div>

    <div class="geo-wrap">
      <!-- Map column -->
      <div class="geo-map-col">
        <div class="geo-toolbar">
          <span class="geo-tlabel">Layers:</span>
          <button class="geo-btn active" data-layer="conflicts"   onclick="toggleGeoLayer('conflicts')">ğŸ”´ Conflicts</button>
          <button class="geo-btn active" data-layer="hotspots"    onclick="toggleGeoLayer('hotspots')">âš¡ Hotspots</button>
          <button class="geo-btn active" data-layer="markets"     onclick="toggleGeoLayer('markets')">ğŸ¦ Markets</button>
          <button class="geo-btn active" data-layer="energy"      onclick="toggleGeoLayer('energy')">ğŸ›¢ï¸ Energy</button>
          <button class="geo-btn"        data-layer="nuclear"     onclick="toggleGeoLayer('nuclear')">â˜¢ï¸ Nuclear</button>
          <button class="geo-btn"        data-layer="military"    onclick="toggleGeoLayer('military')">ğŸª– Military</button>
          <button class="geo-btn"        data-layer="routes"      onclick="toggleGeoLayer('routes')">ğŸš¢ Routes</button>
          <button class="geo-btn"        data-layer="cables"      onclick="toggleGeoLayer('cables')">ğŸ”Œ Cables</button>
          <button class="geo-btn"        data-layer="refugees"    onclick="toggleGeoLayer('refugees')">ğŸ•ï¸ Refugees</button>
          <button class="geo-btn"        data-layer="sanctions"   onclick="toggleGeoLayer('sanctions')">ğŸš« Sanctions</button>
          <button class="geo-btn"        data-layer="earthquakes" onclick="toggleGeoLayer('earthquakes')">ğŸŒ Quakes<span id="quakeCount" class="geo-live-ct"></span></button>
          <button class="geo-btn"        data-layer="natural"     onclick="toggleGeoLayer('natural')">ğŸŒ‹ Natural<span id="naturalCount" class="geo-live-ct"></span></button>
          <button class="geo-btn"        data-layer="flights"     onclick="toggleGeoLayer('flights')">âœˆï¸ Flights<span id="flightCount" class="geo-live-ct"></span></button>
        </div>
        <div id="geoMap"></div>
        <!-- Live intelligence ticker -->
        <div class="geo-intel-bar">
          <span class="geo-intel-label">âš¡ LIVE INTEL</span>
          <div class="geo-intel-wrap">
            <div id="geoIntelTicker" class="geo-intel-ticker">Initializing live intelligence feedsâ€¦ Â· Connecting to NASA EONET Â· Connecting to OpenSky Network Â· Connecting to USGS Seismic Â· Initializing live intelligence feedsâ€¦ Â· Connecting to NASA EONET Â· Connecting to OpenSky Network Â· Connecting to USGS Seismic</div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="geo-side">

        <!-- Stats always visible -->
        <div class="geo-stats-wrap">
          <div class="geo-stats">
            <div class="geo-stat"><div class="geo-stat-lbl">Conflicts</div><div class="geo-stat-val" id="gStatConflicts" style="color:#ef4444">18</div></div>
            <div class="geo-stat"><div class="geo-stat-lbl">Hotspots</div><div class="geo-stat-val" id="gStatHotspots"  style="color:#f97316">14</div></div>
            <div class="geo-stat"><div class="geo-stat-lbl">Quakes</div><div class="geo-stat-val"   id="gStatQuakes"    style="color:#facc15">--</div></div>
            <div class="geo-stat"><div class="geo-stat-lbl">Risk</div><div class="geo-stat-val"     id="gStatRisk"      style="color:#ef4444;font-size:.75rem;margin-top:.15rem;line-height:1.1">CRIT</div></div>
          </div>
        </div>

        <!-- Section tabs -->
        <div class="geo-side-tabs">
          <button class="geo-side-tab-btn stab-active" data-stab="conflicts" onclick="switchGeoTab('conflicts')">ğŸ”´ Conflicts</button>
          <button class="geo-side-tab-btn" data-stab="hotspots"  onclick="switchGeoTab('hotspots')">âš¡ Hotspots</button>
          <button class="geo-side-tab-btn" data-stab="quakes"    onclick="switchGeoTab('quakes')">ğŸŒ Quakes</button>
          <button class="geo-side-tab-btn" data-stab="refugees"  onclick="switchGeoTab('refugees')">ğŸ•ï¸ Refugees</button>
          <button class="geo-side-tab-btn" data-stab="energy"    onclick="switchGeoTab('energy')">ğŸ›¢ï¸ Energy</button>
          <button class="geo-side-tab-btn" data-stab="natural"   onclick="switchGeoTab('natural')">ğŸŒ‹ Natural</button>
          <button class="geo-side-tab-btn" data-stab="flights"   onclick="switchGeoTab('flights')">âœˆï¸ Flights</button>
        </div>

        <!-- Scrollable pane per tab -->
        <div class="geo-side-content">
          <div class="geo-tab-pane stab-active" id="gPaneConflicts">
            <div id="gListConflicts"></div>
          </div>
          <div class="geo-tab-pane" id="gPaneHotspots">
            <div id="gListHotspots"></div>
          </div>
          <div class="geo-tab-pane" id="gPaneQuakes">
            <div id="gListEarthquakes"><div class="geo-evdesc" style="padding:.35rem 0">Loading quake dataâ€¦</div></div>
          </div>
          <div class="geo-tab-pane" id="gPaneRefugees">
            <div id="gListRefugees"></div>
          </div>
          <div class="geo-tab-pane" id="gPaneEnergy">
            <div id="gListEnergy"></div>
          </div>
          <div class="geo-tab-pane" id="gPaneNatural">
            <div id="gListNatural"><div class="geo-evdesc" style="padding:.35rem 0">Loading NASA EONETâ€¦</div></div>
          </div>
          <div class="geo-tab-pane" id="gPaneFlights">
            <div id="gListFlights"><div class="geo-evdesc" style="padding:.35rem 0">Loading OpenSky Networkâ€¦</div></div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       3 Â· MARKETS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="markets">
    <div class="s-hdr">
      <span class="s-hdr-icon">ğŸ“ˆ</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Equities &amp; Indices</div>
        <div class="s-hdr-sub">Multi-asset overview Â· Sector heatmap</div>
      </div>
      <div class="s-hdr-badges"><span class="badge b-live">Live</span></div>
    </div>

    <div class="tv-wrap mb">
      <div class="tv-hdr"><div class="p-title">ğŸŒ Global Asset Classes</div><span class="badge b-live">Live</span></div>
      <div class="tv-body-560" style="height:560px;">
        <div class="tradingview-widget-container" style="height:100%;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
          {"colorTheme":"dark","dateRange":"1D","showChart":true,"locale":"en","width":"100%","height":"100%","isTransparent":true,"showSymbolLogo":true,"showFloatingTooltip":true,
           "plotLineColorGrowing":"rgba(16,185,129,1)","plotLineColorFalling":"rgba(239,68,68,1)",
           "gridLineColor":"rgba(42,46,57,0.2)","scaleFontColor":"rgba(100,116,139,1)",
           "belowLineFillColorGrowing":"rgba(16,185,129,0.06)","belowLineFillColorFalling":"rgba(239,68,68,0.06)",
           "belowLineFillColorGrowingBottom":"rgba(16,185,129,0)","belowLineFillColorFallingBottom":"rgba(239,68,68,0)",
           "symbolActiveColor":"rgba(147,51,234,0.1)",
           "tabs":[
             {"title":"US Indices","symbols":[{"s":"OANDA:SPX500USD","d":"S&P 500"},{"s":"OANDA:NAS100USD","d":"Nasdaq 100"},{"s":"OANDA:US30USD","d":"Dow 30"},{"s":"TVC:RUT","d":"Russell 2000"},{"s":"CBOE:VIX","d":"VIX"}]},
             {"title":"World Indices","symbols":[{"s":"INDEX:FTSE","d":"FTSE 100"},{"s":"INDEX:DEU40","d":"DAX"},{"s":"INDEX:NI225","d":"Nikkei 225"},{"s":"INDEX:HSI","d":"Hang Seng"},{"s":"INDEX:CAC40","d":"CAC 40"},{"s":"INDEX:ASX200","d":"ASX 200"}]},
             {"title":"Bonds","symbols":[{"s":"TVC:US10Y","d":"US 10Y"},{"s":"TVC:US02Y","d":"US 2Y"},{"s":"TVC:US30Y","d":"US 30Y"},{"s":"TVC:DE10Y","d":"Germany 10Y"},{"s":"TVC:GB10Y","d":"UK 10Y"},{"s":"TVC:JP10Y","d":"Japan 10Y"}]},
             {"title":"Commodities","symbols":[{"s":"OANDA:XAUUSD","d":"Gold"},{"s":"OANDA:XAGUSD","d":"Silver"},{"s":"TVC:USOIL","d":"WTI Crude"},{"s":"TVC:UKOIL","d":"Brent Crude"},{"s":"OANDA:NATGASUSD","d":"Natural Gas"},{"s":"CBOT:ZC1!","d":"Corn"}]},
             {"title":"Forex","symbols":[{"s":"FX:EURUSD","d":"EUR/USD"},{"s":"FX:GBPUSD","d":"GBP/USD"},{"s":"FX:USDJPY","d":"USD/JPY"},{"s":"TVC:DXY","d":"Dollar Index"},{"s":"FX:AUDUSD","d":"AUD/USD"},{"s":"FX:USDCAD","d":"USD/CAD"}]},
             {"title":"Crypto","symbols":[{"s":"BINANCE:BTCUSDT","d":"Bitcoin"},{"s":"BINANCE:ETHUSDT","d":"Ethereum"},{"s":"BINANCE:SOLUSDT","d":"Solana"},{"s":"BINANCE:BNBUSDT","d":"BNB"},{"s":"BINANCE:XRPUSDT","d":"XRP"},{"s":"BINANCE:AVAXUSDT","d":"Avalanche"}]}
           ]}
          </script>
        </div>
      </div>
    </div>

    <div class="tv-wrap">
      <div class="tv-hdr"><div class="p-title">ğŸ“Š S&amp;P 500 Sector Heatmap</div><span class="badge b-live">Live</span></div>
      <div class="tv-body-500" style="height:500px;">
        <div class="tradingview-widget-container" style="height:100%;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-stock-heatmap.js" async>
          {"exchanges":[],"dataSource":"SPX500","grouping":"sector","blockSize":"market_cap_basic","blockColor":"change","locale":"en","colorTheme":"dark","hasTopBar":true,"isDataSetEnabled":true,"isZoomEnabled":true,"hasSymbolTooltip":true,"isTransparent":true,"width":"100%","height":"100%"}
          </script>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       4 Â· FOREX
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="forex">
    <div class="s-hdr">
      <span class="s-hdr-icon">ğŸ’±</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Foreign Exchange</div>
        <div class="s-hdr-sub">Heatmap Â· Cross rates matrix Â· Currency strength Â· Market news</div>
      </div>
      <div class="s-hdr-badges"><span class="badge b-live">Live</span></div>
    </div>

    <div class="g2 mb">
      <div class="tv-wrap">
        <div class="tv-hdr"><div class="p-title">ğŸ”¥ Forex Heatmap</div><span class="badge b-live">Live</span></div>
        <div class="tv-body-420" style="height:420px;">
          <div class="tradingview-widget-container" style="height:100%;">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-forex-heat-map.js" async>
            {"width":"100%","height":"100%","currencies":["EUR","USD","JPY","GBP","CHF","AUD","CAD","NZD","CNY"],"isTransparent":true,"colorTheme":"dark","locale":"en"}
            </script>
          </div>
        </div>
      </div>
      <div class="tv-wrap">
        <div class="tv-hdr"><div class="p-title">ğŸ“° Market Intelligence Feed</div><span class="badge b-live">Live</span></div>
        <div class="tv-body-420" style="height:420px;">
          <div class="tradingview-widget-container" style="height:100%;">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
            {"feedMode":"all_symbols","isTransparent":true,"displayMode":"regular","width":"100%","height":"100%","colorTheme":"dark","locale":"en"}
            </script>
          </div>
        </div>
      </div>
    </div>

    <div class="tv-wrap mb">
      <div class="tv-hdr"><div class="p-title">ğŸ’± Cross Rates Matrix</div><span class="badge b-live">Live</span></div>
      <div class="tv-body-440" style="height:440px;">
        <div class="tradingview-widget-container" style="height:100%;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-forex-cross-rates.js" async>
          {"width":"100%","height":"100%","currencies":["EUR","USD","JPY","GBP","CHF","AUD","CAD","NZD"],"isTransparent":true,"colorTheme":"dark","locale":"en"}
          </script>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-hdr">
        <div><div class="p-title">ğŸ“ Currency Strength Index</div><div class="p-sub">Relative strength vs basket</div></div>
        <span class="badge b-hi">Indicative</span>
      </div>
      <div class="panel-body"><div class="cur-list" id="curPanel"></div></div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       5 Â· COMMODITIES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="commodities">
    <div class="s-hdr">
      <span class="s-hdr-icon">ğŸ…</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Commodities &amp; Macro</div>
        <div class="s-hdr-sub">Key commodity markets Â· Macro risk indicators</div>
      </div>
      <div class="s-hdr-badges"><span class="badge b-live">Live</span></div>
    </div>

    <div class="g-com mb">
      <div class="panel">
        <div class="panel-hdr"><div class="p-title">ğŸ¥‡ Gold Â· XAU/USD</div><span class="badge b-live">Live</span></div>
        <div style="height:120px;"><div class="tradingview-widget-container" style="height:100%;"><div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {"symbol":"OANDA:XAUUSD","width":"100%","height":"120","locale":"en","dateRange":"1D","colorTheme":"dark","isTransparent":true,"autosize":false}</script></div></div>
      </div>
      <div class="panel">
        <div class="panel-hdr"><div class="p-title">ğŸ›¢ï¸ WTI Crude Oil</div><span class="badge b-live">Live</span></div>
        <div style="height:120px;"><div class="tradingview-widget-container" style="height:100%;"><div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {"symbol":"TVC:USOIL","width":"100%","height":"120","locale":"en","dateRange":"1D","colorTheme":"dark","isTransparent":true,"autosize":false}</script></div></div>
      </div>
      <div class="panel">
        <div class="panel-hdr"><div class="p-title">ğŸ¥ˆ Silver Â· XAG/USD</div><span class="badge b-live">Live</span></div>
        <div style="height:120px;"><div class="tradingview-widget-container" style="height:100%;"><div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {"symbol":"OANDA:XAGUSD","width":"100%","height":"120","locale":"en","dateRange":"1D","colorTheme":"dark","isTransparent":true,"autosize":false}</script></div></div>
      </div>
      <div class="panel">
        <div class="panel-hdr"><div class="p-title">ğŸ”¥ Natural Gas</div><span class="badge b-live">Live</span></div>
        <div style="height:120px;"><div class="tradingview-widget-container" style="height:100%;"><div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {"symbol":"OANDA:NATGASUSD","width":"100%","height":"120","locale":"en","dateRange":"1D","colorTheme":"dark","isTransparent":true,"autosize":false}</script></div></div>
      </div>
      <div class="panel">
        <div class="panel-hdr"><div class="p-title">ğŸ”´ Copper</div><span class="badge b-live">Live</span></div>
        <div style="height:120px;"><div class="tradingview-widget-container" style="height:100%;"><div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {"symbol":"OANDA:XCUUSD","width":"100%","height":"120","locale":"en","dateRange":"1D","colorTheme":"dark","isTransparent":true,"autosize":false}</script></div></div>
      </div>
      <div class="panel">
        <div class="panel-hdr"><div class="p-title">â›½ Brent Crude</div><span class="badge b-live">Live</span></div>
        <div style="height:120px;"><div class="tradingview-widget-container" style="height:100%;"><div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
          {"symbol":"TVC:UKOIL","width":"100%","height":"120","locale":"en","dateRange":"1D","colorTheme":"dark","isTransparent":true,"autosize":false}</script></div></div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-hdr">
        <div><div class="p-title">âš¡ Macro Risk Monitor</div><div class="p-sub">Qualitative assessment Â· Updated periodically</div></div>
        <span class="badge b-ai">Intelligence</span>
      </div>
      <div class="panel-body">
        <div id="riskPanel" style="display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;"></div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       6 Â· CRYPTO
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="crypto">
    <div class="s-hdr">
      <span class="s-hdr-icon">â‚¿</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Digital Assets</div>
        <div class="s-hdr-sub">Full crypto market screener Â· Top 100 assets</div>
      </div>
      <div class="s-hdr-badges"><span class="badge b-live">Live</span></div>
    </div>
    <div class="tv-wrap">
      <div class="tv-hdr"><div class="p-title">â‚¿ Crypto Market Screener</div><span class="badge b-live">Live</span></div>
      <div class="tv-body-600" style="height:600px;">
        <div class="tradingview-widget-container" style="height:100%;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>
          {"width":"100%","height":"100%","defaultColumn":"overview","screener_type":"crypto_mkt","displayCurrency":"USD","colorTheme":"dark","isTransparent":true,"locale":"en"}
          </script>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       7 Â· CALENDAR
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="page-section" id="calendar">
    <div class="s-hdr">
      <span class="s-hdr-icon">ğŸ“…</span>
      <div class="s-hdr-text">
        <div class="s-hdr-title">Economic Intelligence</div>
        <div class="s-hdr-sub">High-impact events Â· Central bank decisions Â· G8 economies</div>
      </div>
      <div class="s-hdr-badges"><span class="badge b-hi">High Impact</span><span class="badge b-live">Live</span></div>
    </div>
    <div class="tv-wrap">
      <div class="tv-hdr"><div class="p-title">ğŸ“… Economic Calendar</div><span class="badge b-live">Live</span></div>
      <div class="tv-body-620" style="height:620px;">
        <div class="tradingview-widget-container" style="height:100%;">
          <div class="tradingview-widget-container__widget"></div>
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
          {"colorTheme":"dark","isTransparent":true,"width":"100%","height":"100%","locale":"en","importanceFilter":"0,1","countryFilter":"us,eu,gb,jp,cn,au,ca,ch"}
          </script>
        </div>
      </div>
    </div>
  </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js"></script>
<script>
(function () {
  'use strict';

  // â”€â”€ MARKET SESSIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const SESSIONS = [
    { name:'NYSE',  city:'New York',  flag:'ğŸ‡ºğŸ‡¸', tz:'America/New_York',  open:[9,30],  close:[16,0],  pre:[4,0] },
    { name:'LSE',   city:'London',    flag:'ğŸ‡¬ğŸ‡§', tz:'Europe/London',     open:[8,0],   close:[16,30], pre:null  },
    { name:'XETRA', city:'Frankfurt', flag:'ğŸ‡©ğŸ‡ª', tz:'Europe/Berlin',     open:[9,0],   close:[17,30], pre:null  },
    { name:'TSE',   city:'Tokyo',     flag:'ğŸ‡¯ğŸ‡µ', tz:'Asia/Tokyo',        open:[9,0],   close:[15,0],  pre:null  },
    { name:'HKEX',  city:'Hong Kong', flag:'ğŸ‡­ğŸ‡°', tz:'Asia/Hong_Kong',    open:[9,30],  close:[16,0],  pre:null  },
    { name:'SSE',   city:'Shanghai',  flag:'ğŸ‡¨ğŸ‡³', tz:'Asia/Shanghai',     open:[9,30],  close:[15,0],  pre:null  },
    { name:'ASX',   city:'Sydney',    flag:'ğŸ‡¦ğŸ‡º', tz:'Australia/Sydney',  open:[10,0],  close:[16,0],  pre:null  },
  ];

  function localAt(tz) { return new Date(new Date().toLocaleString('en-US',{timeZone:tz})); }
  function mins(h,m)   { return h*60+m; }

  function getStatus(s) {
    var t=localAt(s.tz), day=t.getDay(), now=mins(t.getHours(),t.getMinutes());
    if(day===0||day===6) return 'closed';
    if(now>=mins(s.open[0],s.open[1])&&now<mins(s.close[0],s.close[1])) return 'open';
    if(s.pre&&now>=mins(s.pre[0],s.pre[1])&&now<mins(s.open[0],s.open[1])) return 'pre';
    return 'closed';
  }
  function fmtTime(tz) { return localAt(tz).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:false}); }

  function renderSessions() {
    var panel=document.getElementById('sessPanel'), bar=document.getElementById('sessBar');
    if(!panel||!bar) return;
    panel.innerHTML = SESSIONS.map(function(s){
      var st=getStatus(s),t=fmtTime(s.tz);
      var cls=st==='open'?'st-open':st==='pre'?'st-pre':'st-closed';
      var lbl=st==='open'?'â— OPEN':st==='pre'?'â— PRE':'CLOSED';
      return '<div class="sess-row '+st+'"><span class="sr-flag">'+s.flag+'</span><span class="sr-name">'+s.name+'</span><div><div class="sr-city">'+s.city+'</div><div class="sr-time">'+t+'</div></div><span class="sr-status '+cls+'">'+lbl+'</span></div>';
    }).join('');
    bar.innerHTML = SESSIONS.map(function(s){
      var st=getStatus(s),t=fmtTime(s.tz);
      return '<div class="sess-chip '+st+'"><div class="sess-dot"></div>'+s.flag+' '+s.name+' <span style="opacity:.65">'+t+'</span></div>';
    }).join('');
  }

  // â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function tick() {
    var el=document.getElementById('utcClock');
    if(el) el.textContent=new Date().toLocaleTimeString('en-US',{timeZone:'UTC',hour12:false})+' UTC';
    renderSessions();
  }

  // â”€â”€ SCROLLSPY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var SIDS=['overview','global','markets','forex','commodities','crypto','calendar'];
  window.addEventListener('scroll',function(){
    var cur=SIDS[0];
    SIDS.forEach(function(id){var el=document.getElementById(id);if(el&&el.getBoundingClientRect().top<=220)cur=id;});
    document.querySelectorAll('.tab-btn').forEach(function(b){b.classList.toggle('active',b.dataset.tab===cur);});
  },{passive:true});

  window.jumpTo=function(id){var el=document.getElementById(id);if(el)el.scrollIntoView({behavior:'smooth'});};

  // â”€â”€ FEAR & GREED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function fetchFG() {
    try {
      var r=await fetch('https://api.alternative.me/fng/?limit=1');
      var d=await r.json(); var v=parseInt(d.data[0].value);
      var label=d.data[0].value_classification;
      var color=v<=25?'#ef4444':v<=45?'#f97316':v<=55?'#eab308':v<=75?'#84cc16':'#10b981';
      var ne=document.getElementById('fgNum'),le=document.getElementById('fgLbl');
      if(ne){ne.textContent=v;ne.style.color=color;}
      if(le){le.textContent=label.toUpperCase();le.style.color=color;}
      var ndl=document.getElementById('fgNeedle');
      if(ndl){ndl.style.transform='rotate('+(v/100*180-90)+'deg)';ndl.style.transformOrigin='90px 90px';}
      var arc=document.getElementById('fgArc');
      if(arc) arc.style.strokeDashoffset=239-(v/100)*239;
      ['fgb0','fgb1','fgb2','fgb3','fgb4'].forEach(function(id){var b=document.getElementById(id);if(b)b.classList.remove('active');});
      var idx=v<=25?0:v<=45?1:v<=55?2:v<=75?3:4;
      var ab=document.getElementById('fgb'+idx);if(ab)ab.classList.add('active');
    } catch(e){var le=document.getElementById('fgLbl');if(le)le.textContent='DATA UNAVAILABLE';}
  }

  // â”€â”€ CRYPTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function bigNum(n){if(n>=1e12)return'$'+(n/1e12).toFixed(2)+'T';if(n>=1e9)return'$'+(n/1e9).toFixed(2)+'B';if(n>=1e6)return'$'+(n/1e6).toFixed(1)+'M';return'$'+n.toLocaleString();}
  function setEl(id,val,cls){var el=document.getElementById(id);if(!el)return;el.classList.remove('shimmer');el.textContent=val;if(cls)el.className=cls;}

  async function fetchCrypto() {
    try {
      var res=await Promise.all([fetch('https://api.coingecko.com/api/v3/global'),fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true')]);
      var g=(await res[0].json()).data,p=await res[1].json();
      var btc=p.bitcoin,eth=p.ethereum;
      setEl('btcP','$'+btc.usd.toLocaleString('en-US',{maximumFractionDigits:0}));
      var bc=btc.usd_24h_change.toFixed(2);setEl('btcC',(bc>=0?'+':'')+bc+'%','cm-chg '+(bc>=0?'up':'down'));
      setEl('ethP','$'+eth.usd.toLocaleString('en-US',{maximumFractionDigits:0}));
      var ec=eth.usd_24h_change.toFixed(2);setEl('ethC',(ec>=0?'+':'')+ec+'%','cm-chg '+(ec>=0?'up':'down'));
      setEl('mktC',bigNum(g.total_market_cap.usd));
      var mc=g.market_cap_change_percentage_24h_usd.toFixed(2);setEl('mktCC',(mc>=0?'+':'')+mc+'% 24h','cm-chg '+(mc>=0?'up':'down'));
      setEl('vol',bigNum(g.total_volume.usd));
      var bd=g.market_cap_percentage.btc.toFixed(1),ed=g.market_cap_percentage.eth.toFixed(1);
      setEl('btcD',bd+'%');setEl('ethD',ed+'%');
      var bb=document.getElementById('btcDB'),eb=document.getElementById('ethDB');
      if(bb)bb.style.width=bd+'%';if(eb)eb.style.width=ed+'%';
    } catch(e){}
  }

  // â”€â”€ CURRENCY STRENGTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var CURRENCIES=[
    {code:'USD',flag:'ğŸ‡ºğŸ‡¸',color:'#60a5fa',val:72},{code:'EUR',flag:'ğŸ‡ªğŸ‡º',color:'#818cf8',val:58},
    {code:'GBP',flag:'ğŸ‡¬ğŸ‡§',color:'#a78bfa',val:52},{code:'JPY',flag:'ğŸ‡¯ğŸ‡µ',color:'#f472b6',val:42},
    {code:'CHF',flag:'ğŸ‡¨ğŸ‡­',color:'#34d399',val:68},{code:'AUD',flag:'ğŸ‡¦ğŸ‡º',color:'#fbbf24',val:45},
    {code:'CAD',flag:'ğŸ‡¨ğŸ‡¦',color:'#fb923c',val:48},{code:'NZD',flag:'ğŸ‡³ğŸ‡¿',color:'#a3e635',val:40},
  ];
  function renderCurrencies(){
    var el=document.getElementById('curPanel');if(!el)return;
    var mx=Math.max.apply(null,CURRENCIES.map(function(c){return c.val;}));
    el.innerHTML=CURRENCIES.map(function(c){
      var pct=(c.val/mx*100).toFixed(0),st=c.val>55;
      return '<div class="cur-row"><div class="cur-code">'+c.flag+' '+c.code+'</div><div class="bar-track"><div class="bar-fill" style="width:'+pct+'%;background:'+c.color+';"></div></div><div class="cur-val '+(st?'up':'down')+'">'+(st?'â–²':'â–¼')+' '+c.val+'</div></div>';
    }).join('');
  }

  // â”€â”€ MACRO RISK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var RISKS=[
    {label:'Yield Curve',   desc:'2Y-10Y spread',        level:'ELEVATED',dots:3,color:'#f97316'},
    {label:'Credit Spreads',desc:'HY vs IG bonds',        level:'MODERATE', dots:2,color:'#eab308'},
    {label:'Geopolitical',  desc:'Global conflict index', level:'HIGH',     dots:4,color:'#ef4444'},
    {label:'Inflation',     desc:'CPI trend momentum',    level:'MODERATE', dots:2,color:'#eab308'},
    {label:'USD Liquidity', desc:'Fed balance sheet',     level:'LOW',      dots:1,color:'#10b981'},
    {label:'Volatility',    desc:'VIX regime',            level:'MODERATE', dots:2,color:'#eab308'},
  ];
  function renderRisk(){
    var el=document.getElementById('riskPanel');if(!el)return;
    el.innerHTML=RISKS.map(function(r){
      return '<div class="risk-row"><div><div class="r-lbl">'+r.label+'</div><div class="r-desc">'+r.desc+'</div></div><div class="r-right"><span class="r-lvl" style="color:'+r.color+'">'+r.level+'</span><div class="r-dots">'+[1,2,3,4,5].map(function(d){return'<div class="r-dot '+(d<=r.dots?'on':'off')+'" style="'+(d<=r.dots?'background:'+r.color:'')+'"></div>';}).join('')+'</div></div></div>';
    }).join('');
  }

  // â”€â”€ GEO MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var CONFLICTS=[
    {lat:49.0, lng: 31.0, name:'Ukraine',           detail:'Russia-Ukraine War Â· 3rd year',               sev:'critical'},
    {lat:31.5, lng: 34.5, name:'Gaza Strip',         detail:'Israel-Hamas Conflict Â· Ongoing',             sev:'critical'},
    {lat:15.5, lng: 30.5, name:'Sudan',              detail:'SAF vs RSF Civil War',                        sev:'critical'},
    {lat:19.0, lng: 96.0, name:'Myanmar',            detail:'Military Junta vs Resistance',                sev:'critical'},
    {lat:-4.0, lng: 22.0, name:'DR Congo',           detail:'M23 Rebel Offensive Â· Eastern DRC',           sev:'critical'},
    {lat:35.0, lng: 38.0, name:'Syria',              detail:'HTS Post-Assad Instability',                  sev:'high'},
    {lat: 4.0, lng: 42.0, name:'Somalia',            detail:'Al-Shabaab Insurgency',                       sev:'high'},
    {lat:13.5, lng:  2.0, name:'Sahel Region',       detail:'Jihadist Insurgencies Â· Burkina/Mali/Niger',  sev:'high'},
    {lat:10.0, lng:  8.0, name:'Nigeria',            detail:'Boko Haram / ISWAP Insurgency',               sev:'high'},
    {lat:15.3, lng: 44.2, name:'Yemen',              detail:'Houthi Operations Â· Red Sea Attacks',         sev:'high'},
    {lat:18.5, lng:-72.3, name:'Haiti',              detail:'Gang Violence Â· State Collapse',              sev:'high'},
    {lat: 8.5, lng: 38.5, name:'Ethiopia',           detail:'Amhara & Oromia Conflicts',                   sev:'elevated'},
    {lat:-18.0,lng: 35.0, name:'Mozambique',         detail:'ISCAP Insurgency Â· Cabo Delgado',             sev:'elevated'},
    {lat:33.0, lng: 65.0, name:'Afghanistan',        detail:'Taliban Rule Â· ISIS-K Attacks',               sev:'elevated'},
    {lat:40.4, lng: 46.8, name:'Nagorno-Karabakh',   detail:'Post-War Tensions Â· Armenian Exodus',         sev:'elevated'},
    {lat:30.0, lng: 70.0, name:'Pakistan',           detail:'TTP Attacks Â· Balochistan Unrest',            sev:'elevated'},
    {lat:11.0, lng: 43.1, name:'Horn of Africa',     detail:'Regional Instability Â· Piracy',               sev:'elevated'},
    {lat:11.5, lng: 15.0, name:'Lake Chad Basin',    detail:'Multi-State Insurgency Â· Boko Haram Splinter',sev:'elevated'},
  ];

  var HOTSPOTS=[
    {lat:23.5, lng:119.5, name:'Taiwan Strait',      detail:'China-Taiwan Military Tensions',              sev:'critical'},
    {lat:10.0, lng:113.0, name:'South China Sea',    detail:'Territorial Disputes Â· Naval Standoffs',      sev:'high'},
    {lat:38.0, lng:127.5, name:'Korean Peninsula',   detail:'DPRK Missile Provocations',                   sev:'high'},
    {lat:32.0, lng: 53.0, name:'Iran',               detail:'Nuclear Program Â· Proxy Networks',            sev:'high'},
    {lat:12.5, lng: 43.5, name:'Red Sea',            detail:'Houthi Shipping Attacks Â· NATO Escort',       sev:'high'},
    {lat:14.0, lng:  2.0, name:'Niger / Sahel Coup', detail:'Military Coups Â· Wagner/Russia Expansion',    sev:'high'},
    {lat:56.0, lng: 22.0, name:'Baltic Flank',       detail:'NATO-Russia Tensions Â· Article 5 Tripwire',   sev:'elevated'},
    {lat:53.0, lng: 28.0, name:'Belarus',            detail:'Lukashenko Regime Â· Russia Forward Base',     sev:'elevated'},
    {lat:42.5, lng: 21.0, name:'Serbia-Kosovo',      detail:'Renewed Ethnic Tensions',                     sev:'elevated'},
    {lat:37.5, lng: 25.0, name:'Aegean Sea',         detail:'Greece-Turkey Maritime Dispute',              sev:'elevated'},
    {lat:34.5, lng: 77.5, name:'Kashmir',            detail:'India-Pakistan Standoff Â· LOC Violations',    sev:'elevated'},
    {lat: 6.0, lng:-66.0, name:'Venezuela-Guyana',   detail:'Essequibo Border Dispute',                    sev:'elevated'},
    {lat:40.2, lng: 47.0, name:'South Caucasus',     detail:'Armenia-Azerbaijan Post-War Tensions',        sev:'elevated'},
    {lat:17.5, lng:-92.0, name:'Mexico Drug War',    detail:'Cartel Violence Â· State Capture Risk',        sev:'elevated'},
  ];

  var ENERGY=[
    {lat:26.5, lng: 56.5, name:'Strait of Hormuz',  detail:'~20% of global oil transit',          icon:'ğŸ›¢ï¸'},
    {lat:30.0, lng: 32.5, name:'Suez Canal',         detail:'~12% of global trade route',          icon:'âš“'},
    {lat: 1.5, lng:103.5, name:'Strait of Malacca',  detail:'~40% of global shipping',             icon:'âš“'},
    {lat:41.0, lng: 29.0, name:'Turkish Straits',    detail:'Bosphorus Â· Black Sea oil egress',    icon:'âš“'},
    {lat:-34.0,lng: 18.5, name:'Cape of Good Hope',  detail:'Alt route bypassing Suez/Hormuz',     icon:'âš“'},
    {lat:57.0, lng: 11.0, name:'Danish Straits',     detail:'Baltic Sea energy gateway',           icon:'âš“'},
    {lat:61.0, lng:  2.5, name:'North Sea',          detail:'Brent crude production hub',          icon:'ğŸ›¢ï¸'},
    {lat:30.5, lng: 47.5, name:'Persian Gulf',       detail:'Major oil export corridor',           icon:'ğŸ›¢ï¸'},
    {lat:40.5, lng: 52.0, name:'Caspian Basin',      detail:'Landlocked oil & gas export hub',     icon:'ğŸ›¢ï¸'},
    {lat:34.0, lng: 31.0, name:'E. Med Gas Fields',  detail:'Leviathan/Aphrodite discoveries',     icon:'ğŸ”¥'},
    {lat:28.0, lng:-100.0,name:'Permian Basin',      detail:'US shale production center',          icon:'â›½'},
    {lat:65.0, lng: 55.0, name:'West Siberia',       detail:'Russia gas pipeline network',         icon:'ğŸ”¥'},
  ];

  var NUCLEAR=[
    {lat:38.9, lng:-77.0, name:'USA',         detail:'~5,500 warheads'},
    {lat:55.75,lng: 37.6, name:'Russia',      detail:'~6,200 warheads'},
    {lat:51.5, lng: -0.1, name:'UK',          detail:'~225 warheads'},
    {lat:48.85,lng:  2.35,name:'France',      detail:'~290 warheads'},
    {lat:39.9, lng:116.4, name:'China',       detail:'~500 warheads'},
    {lat:28.7, lng: 77.1, name:'India',       detail:'~172 warheads'},
    {lat:33.7, lng: 73.1, name:'Pakistan',    detail:'~170 warheads'},
    {lat:31.8, lng: 35.2, name:'Israel',      detail:'~90 warheads (est.)'},
    {lat:39.0, lng:127.0, name:'North Korea', detail:'~40-50 warheads (est.)'},
  ];

  var MARKETS=[
    {lat:40.71, lng:-74.01, name:'New York',   exchange:'NYSE / NASDAQ', session:'NYSE'},
    {lat:51.51, lng: -0.13, name:'London',     exchange:'LSE',           session:'LSE'},
    {lat:50.11, lng:  8.68, name:'Frankfurt',  exchange:'XETRA',         session:'XETRA'},
    {lat:35.68, lng:139.65, name:'Tokyo',      exchange:'TSE',           session:'TSE'},
    {lat:22.32, lng:114.17, name:'Hong Kong',  exchange:'HKEX',          session:'HKEX'},
    {lat:31.23, lng:121.47, name:'Shanghai',   exchange:'SSE',           session:'SSE'},
    {lat:-33.87,lng:151.21, name:'Sydney',     exchange:'ASX',           session:'ASX'},
    {lat:19.08, lng: 72.88, name:'Mumbai',     exchange:'BSE / NSE',     session:null},
    {lat: 1.35, lng:103.82, name:'Singapore',  exchange:'SGX',           session:null},
    {lat:43.65, lng:-79.38, name:'Toronto',    exchange:'TSX',           session:null},
  ];

  var MILITARY=[
    {lat:36.3, lng: -5.4, name:'Gibraltar (UK/NATO)', detail:'Naval base Â· Mediterranean gateway',     col:'#3b82f6'},
    {lat:35.9, lng: 14.5, name:'Malta (NATO)',         detail:'Joint NATO Mediterranean HQ',            col:'#3b82f6'},
    {lat:64.8, lng:-14.0, name:'Keflavik (NATO)',      detail:'Iceland GIUK gap monitoring',            col:'#3b82f6'},
    {lat:35.5, lng: 24.0, name:'Souda Bay (US/NATO)',  detail:'Largest US naval base in Med',           col:'#ef4444'},
    {lat:37.0, lng: 35.4, name:'Incirlik AB (NATO)',   detail:'US nukes stored Â· Turkey NATO base',     col:'#ef4444'},
    {lat:11.5, lng: 43.1, name:'Camp Lemonnier',       detail:'US AFRICOM HQ Â· Djibouti',              col:'#ef4444'},
    {lat:25.2, lng: 55.3, name:'Al Dhafra AB (US)',    detail:'Major US Air Force base Â· UAE',          col:'#ef4444'},
    {lat:26.2, lng: 50.6, name:'NSA Bahrain (US)',     detail:'US 5th Fleet HQ',                       col:'#ef4444'},
    {lat:36.9, lng:140.0, name:'Yokosuka (US)',        detail:'US 7th Fleet HQ Â· Japan',               col:'#ef4444'},
    {lat:13.5, lng:144.8, name:'Andersen AB (US)',     detail:'Guam strategic bomber base',             col:'#ef4444'},
    {lat:36.8, lng: 10.2, name:'US Access Â· Tunisia',  detail:'US-Tunisia security cooperation',        col:'#ef4444'},
    {lat:44.8, lng: 33.5, name:'Sevastopol (Russia)',  detail:'Black Sea Fleet HQ',                     col:'#9333ea'},
    {lat:34.7, lng: 36.0, name:'Tartus (Russia)',      detail:'Russia Med naval facility Â· Syria',      col:'#9333ea'},
    {lat:22.5, lng:113.9, name:'Zhanjiang (PLAN)',     detail:'China South Sea Fleet HQ',               col:'#f59e0b'},
    {lat:11.6, lng: 43.2, name:'Djibouti (China PLA)', detail:'First overseas Chinese naval base',      col:'#f59e0b'},
  ];

  var ROUTES=[
    {name:'Trans-Atlantic',      color:'#3b82f6', weight:1.5, dash:'6,4',
     coords:[[40.71,-74.01],[45.0,-30.0],[51.51,-0.13]]},
    {name:'Trans-Pacific',       color:'#06b6d4', weight:1.5, dash:'6,4',
     coords:[[37.77,-122.4],[40.0,-170.0],[35.68,139.65]]},
    {name:'Suez / Indian Ocean', color:'#10b981', weight:1.5, dash:'4,3',
     coords:[[51.51,-0.13],[36.0,14.0],[30.0,32.5],[12.5,43.5],[26.5,56.5],[20.0,65.0],[1.5,103.5]]},
    {name:'Cape of Good Hope',   color:'#f59e0b', weight:1.5, dash:'8,5',
     coords:[[51.51,-0.13],[-5.0,0.0],[-34.0,18.5],[-20.0,50.0],[1.5,103.5]]},
    {name:'Red Sea Houthi Zone', color:'#ef4444', weight:2.0, dash:'3,3',
     coords:[[12.5,43.5],[15.0,42.5],[20.0,38.0],[26.5,36.0]]},
  ];

  var CABLES=[
    {lat:50.8, lng: -1.1, name:'Southampton Hub',   detail:'Major transatlantic cable landing Â· UK'},
    {lat:40.6, lng:-73.9, name:'New York Hub',       detail:'Atlantic cable terminus Â· ~25 cables'},
    {lat:37.7, lng:-122.4,name:'San Francisco Hub',  detail:'Trans-Pacific cable landing Â· US West'},
    {lat: 1.3, lng:103.8, name:'Singapore Hub',      detail:'Asia-Pacific cable nexus Â· largest hub'},
    {lat:35.7, lng:139.7, name:'Tokyo Hub',          detail:'Trans-Pacific cable terminus Â· Japan'},
    {lat:22.3, lng:114.2, name:'Hong Kong Hub',      detail:'Asia submarine cable center'},
    {lat:19.4, lng: 72.8, name:'Mumbai Hub',         detail:'India-Europe cable landing Â· SEA-ME-WE'},
    {lat:11.6, lng: 43.1, name:'Djibouti Hub',       detail:'East-West cable chokepoint Â· 9+ cables'},
    {lat:31.2, lng: 32.3, name:'Suez Hub',           detail:'Med-Asia cable corridor pinch point'},
    {lat:-33.9,lng:151.2, name:'Sydney Hub',         detail:'Pacific cable terminus Â· Australia'},
  ];

  var REFUGEES=[
    {lat:36.0, lng: 37.0, name:'Syrian Refugees',   detail:'~5.3M abroad Â· Turkey/Lebanon/Jordan',       count:'5.3M'},
    {lat:49.5, lng: 31.5, name:'Ukraine Displaced',  detail:'~6.5M fled to Europe Â· largest post-WWII',   count:'6.5M'},
    {lat:15.5, lng: 30.5, name:'Sudan Displaced',    detail:'~9M IDP + refugees Â· growing crisis',        count:'9M'},
    {lat:31.5, lng: 34.5, name:'Gaza Displaced',     detail:'~1.9M internally displaced Â· 75%+ pop',      count:'1.9M'},
    {lat:19.0, lng: 96.0, name:'Myanmar Displaced',  detail:'~2.6M fled military coup violence',          count:'2.6M'},
    {lat:13.0, lng:  2.0, name:'Sahel Displaced',    detail:'~3.1M across Burkina Faso/Mali/Niger',       count:'3.1M'},
    {lat:15.3, lng: 44.2, name:'Yemen Displaced',    detail:'~4.5M IDP Â· famine conditions',              count:'4.5M'},
    {lat:-4.0, lng: 22.0, name:'DRC Displaced',      detail:'~6.9M IDP Â· worst Africa crisis',            count:'6.9M'},
    {lat:33.0, lng: 65.0, name:'Afghan Refugees',    detail:'~6M abroad Â· Iran and Pakistan hosts',       count:'6M'},
  ];

  var SANCTIONS=[
    {lat:55.75,lng: 37.6, name:'Russia',       detail:'SWIFT removal Â· oil cap Â· full sectoral',     col:'#ef4444'},
    {lat:35.7, lng: 51.4, name:'Iran',         detail:'Nuclear sanctions Â· OFAC SDN Â· arms embargo', col:'#ef4444'},
    {lat:39.0, lng:127.0, name:'North Korea',  detail:'Full UN embargo Â· arms/finance/tech ban',     col:'#ef4444'},
    {lat:39.9, lng:116.4, name:'China',        detail:'Chip export controls Â· entity list targets',  col:'#f97316'},
    {lat:10.5, lng:-66.9, name:'Venezuela',    detail:'OFAC sanctions Â· Maduro regime targets',      col:'#f97316'},
    {lat:35.0, lng: 38.0, name:'Syria',        detail:'Caesar Act Â· EU/US comprehensive sanctions',  col:'#f97316'},
    {lat:53.9, lng: 27.6, name:'Belarus',      detail:'EU/US sanctions Â· Lukashenko regime',         col:'#f59e0b'},
    {lat:15.5, lng: 30.5, name:'Sudan (SAF)',  detail:'Arms embargo Â· targeted individual sanctions', col:'#f59e0b'},
  ];

  var geoLayers={}, geoMap=null;

  function sevColor(sev){ return sev==='critical'?'#ef4444':sev==='high'?'#f97316':'#f59e0b'; }

  function popHtml(title,desc,sev,titleColor){
    var bg=sev==='critical'?'rgba(239,68,68,.15)':sev==='high'?'rgba(249,115,22,.15)':'rgba(245,158,11,.15)';
    return '<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+(titleColor||sevColor(sev))+'">'+title+'</div><div class="geo-popup-desc">'+desc+'</div><div class="geo-popup-sev" style="background:'+bg+';color:'+(titleColor||sevColor(sev))+'">'+sev.toUpperCase()+'</div></div>';
  }

  async function fetchEarthquakes(){
    try{
      var r=await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson');
      var d=await r.json();
      geoLayers.earthquakes.clearLayers();
      var count=0;
      d.features.forEach(function(f){
        if(!f.geometry||f.geometry.type!=='Point') return;
        var c=f.geometry.coordinates, mag=+(f.properties.mag||0).toFixed(1);
        var place=f.properties.place||'Unknown location';
        var time=new Date(f.properties.time).toISOString().slice(0,10);
        var col=mag>=7?'#ef4444':mag>=6?'#f97316':mag>=5?'#f59e0b':'#facc15';
        var sz=Math.max(5,Math.min(16,Math.round((mag-4)*3.5)));
        var icon=L.divIcon({className:'',iconSize:[sz*2,sz*2],iconAnchor:[sz,sz],
          html:'<div style="position:relative;width:'+(sz*2)+'px;height:'+(sz*2)+'px;display:flex;align-items:center;justify-content:center;">'
              +'<div style="position:absolute;inset:0;border-radius:50%;border:1px solid '+col+';opacity:.4;animation:pulseRing 3s ease-out infinite;"></div>'
              +'<div style="width:'+sz+'px;height:'+sz+'px;border-radius:50%;background:'+col+';opacity:.75;"></div>'
              +'</div>'
        });
        var html='<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+col+'">ğŸŒ M'+mag+' Earthquake</div><div class="geo-popup-desc">'+place+'</div><div class="geo-popup-desc" style="margin-top:.2rem;opacity:.7">'+time+'</div><div class="geo-popup-sev" style="background:rgba(250,204,21,.12);color:'+col+'">MAGNITUDE '+mag+'</div></div>';
        L.marker([c[1],c[0]],{icon:icon}).bindPopup(html,{maxWidth:220,className:'geo-popup-wrap'}).addTo(geoLayers.earthquakes);
        count++;
      });
      var qc=document.getElementById('quakeCount'); if(qc) qc.textContent=count;
      var qs=document.getElementById('gStatQuakes');  if(qs) qs.textContent=count;
      renderEarthquakeSidebar(d.features);
    }catch(e){ console.warn('USGS quakes fetch failed',e); }
  }

  function renderEarthquakeSidebar(features){
    var el=document.getElementById('gListEarthquakes'); if(!el) return;
    var top=features.filter(function(f){ return (f.properties.mag||0)>=5.5; }).slice(0,8);
    if(!top.length){ el.innerHTML='<div class="geo-evdesc" style="padding:.25rem 0">No M5.5+ quakes this week.</div>'; return; }
    el.innerHTML=top.map(function(f){
      var mag=+(f.properties.mag||0).toFixed(1), place=(f.properties.place||'Unknown').substring(0,30);
      var time=new Date(f.properties.time).toISOString().slice(0,10);
      var col=mag>=7?'#ef4444':mag>=6?'#f97316':'#f59e0b';
      var sev=mag>=7?'critical':mag>=6?'high':'elevated';
      var c=f.geometry&&f.geometry.coordinates;
      var click=c?'onclick="flyToGeo('+c[1]+','+c[0]+')" title="Click to zoom"':'';
      return '<div class="geo-event '+sev+'" '+click+'><div class="geo-evname"><span>M'+mag+' Â· '+place+'</span><span class="sev-badge" style="background:rgba(250,204,21,.1);color:'+col+'">M'+mag+'</span></div><div class="geo-evdesc">'+time+'</div></div>';
    }).join('');
  }

  function initGeoMap(){
    if(typeof L==='undefined'||!document.getElementById('geoMap')) return;

    geoMap=L.map('geoMap',{center:[25,15],zoom:2,zoomControl:false,attributionControl:false,minZoom:2,maxZoom:6,worldCopyJump:true});
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{subdomains:'abcd',maxZoom:6}).addTo(geoMap);
    L.control.zoom({position:'topright'}).addTo(geoMap);
    L.control.attribution({position:'bottomright',prefix:false}).addAttribution('Â© CartoDB').addTo(geoMap);

    geoLayers.conflicts   = L.layerGroup();
    geoLayers.hotspots    = L.layerGroup();
    geoLayers.markets     = L.layerGroup();
    geoLayers.energy      = L.layerGroup();
    geoLayers.nuclear     = L.layerGroup();
    geoLayers.military    = L.layerGroup();
    geoLayers.routes      = L.layerGroup();
    geoLayers.cables      = L.layerGroup();
    geoLayers.refugees    = L.layerGroup();
    geoLayers.sanctions   = L.layerGroup();
    geoLayers.earthquakes = L.layerGroup();
    geoLayers.natural     = L.layerGroup();
    geoLayers.flights     = L.layerGroup();

    // Conflicts â€” pulsing filled circles
    CONFLICTS.forEach(function(c){
      var col=sevColor(c.sev), sz=c.sev==='critical'?14:c.sev==='high'?11:9;
      var icon=L.divIcon({className:'',iconSize:[sz*3,sz*3],iconAnchor:[sz*1.5,sz*1.5],
        html:'<div style="position:relative;width:'+(sz*3)+'px;height:'+(sz*3)+'px;display:flex;align-items:center;justify-content:center;">'
            +'<div style="position:absolute;width:'+(sz*3)+'px;height:'+(sz*3)+'px;border-radius:50%;background:'+col+'22;animation:pulseRing 2s ease-out infinite;"></div>'
            +'<div style="width:'+sz+'px;height:'+sz+'px;border-radius:50%;background:'+col+';box-shadow:0 0 '+(sz*1.5)+'px '+col+'80;animation:pulseMap 2s ease-in-out infinite;"></div>'
            +'</div>'
      });
      L.marker([c.lat,c.lng],{icon:icon}).bindPopup(popHtml('ğŸ”´ '+c.name,c.detail,c.sev),{maxWidth:200,className:'geo-popup-wrap'}).addTo(geoLayers.conflicts);
    });

    // Hotspots â€” hollow pulsing rings
    HOTSPOTS.forEach(function(h){
      var col=sevColor(h.sev);
      var icon=L.divIcon({className:'',iconSize:[18,18],iconAnchor:[9,9],
        html:'<div style="position:relative;width:18px;height:18px;display:flex;align-items:center;justify-content:center;">'
            +'<div style="position:absolute;inset:0;border-radius:50%;border:1.5px solid '+col+';opacity:.5;animation:pulseRing 2.5s ease-out infinite;"></div>'
            +'<div style="width:8px;height:8px;border-radius:50%;border:2px solid '+col+';background:transparent;"></div>'
            +'</div>'
      });
      L.marker([h.lat,h.lng],{icon:icon}).bindPopup(popHtml('âš¡ '+h.name,h.detail,h.sev),{maxWidth:200,className:'geo-popup-wrap'}).addTo(geoLayers.hotspots);
    });

    // Markets â€” diamond markers, green if open
    MARKETS.forEach(function(m){
      var isOpen=m.session&&getStatus(SESSIONS.find(function(s){return s.name===m.session;})||{})==='open';
      var col=isOpen?'#00ff88':'#64748b';
      var icon=L.divIcon({className:'',iconSize:[10,10],iconAnchor:[5,5],
        html:'<div style="width:8px;height:8px;background:'+col+';transform:rotate(45deg);box-shadow:0 0 8px '+col+'80;'+(isOpen?'animation:pulseMap 2.2s ease-in-out infinite;':'')+'"></div>'
      });
      L.marker([m.lat,m.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+col+'">ğŸ¦ '+m.name+'</div><div class="geo-popup-desc">'+m.exchange+'</div><div class="geo-popup-sev" style="background:'+(isOpen?'rgba(0,255,136,.15)':'rgba(100,116,139,.15)')+';color:'+col+'">'+(isOpen?'MARKET OPEN':'MARKET CLOSED')+'</div></div>',{maxWidth:180,className:'geo-popup-wrap'})
        .addTo(geoLayers.markets);
    });

    // Energy â€” emoji markers
    ENERGY.forEach(function(e){
      var icon=L.divIcon({className:'',iconSize:[14,14],iconAnchor:[7,7],
        html:'<div style="font-size:11px;line-height:1;filter:drop-shadow(0 0 4px rgba(245,158,11,.6));">'+e.icon+'</div>'
      });
      L.marker([e.lat,e.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:#f59e0b">'+e.icon+' '+e.name+'</div><div class="geo-popup-desc">'+e.detail+'</div></div>',{maxWidth:200,className:'geo-popup-wrap'})
        .addTo(geoLayers.energy);
    });

    // Nuclear â€” â˜¢ï¸ markers
    NUCLEAR.forEach(function(n){
      var icon=L.divIcon({className:'',iconSize:[12,12],iconAnchor:[6,6],
        html:'<div style="font-size:9px;line-height:1;opacity:.65;filter:drop-shadow(0 0 3px rgba(167,139,250,.5));">â˜¢ï¸</div>'
      });
      L.marker([n.lat,n.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:#a78bfa">â˜¢ï¸ '+n.name+'</div><div class="geo-popup-desc">'+n.detail+'</div></div>',{maxWidth:180,className:'geo-popup-wrap'})
        .addTo(geoLayers.nuclear);
    });

    // Military bases â€” triangle markers
    MILITARY.forEach(function(m){
      var icon=L.divIcon({className:'',iconSize:[12,12],iconAnchor:[6,10],
        html:'<div style="width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:9px solid '+m.col+';opacity:.85;filter:drop-shadow(0 0 3px '+m.col+'60);"></div>'
      });
      L.marker([m.lat,m.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+m.col+'">ğŸª– '+m.name+'</div><div class="geo-popup-desc">'+m.detail+'</div></div>',{maxWidth:210,className:'geo-popup-wrap'})
        .addTo(geoLayers.military);
    });

    // Maritime routes â€” dashed polylines
    ROUTES.forEach(function(r){
      L.polyline(r.coords,{color:r.color,weight:r.weight,opacity:.55,dashArray:r.dash})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+r.color+'">ğŸš¢ '+r.name+'</div></div>',{maxWidth:180,className:'geo-popup-wrap'})
        .addTo(geoLayers.routes);
    });

    // Submarine cable landing points â€” small purple dots
    CABLES.forEach(function(c){
      var icon=L.divIcon({className:'',iconSize:[10,10],iconAnchor:[5,5],
        html:'<div style="width:6px;height:6px;border-radius:50%;background:#a78bfa;border:1px solid rgba(167,139,250,.5);box-shadow:0 0 6px rgba(167,139,250,.4);"></div>'
      });
      L.marker([c.lat,c.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:#a78bfa">ğŸ”Œ '+c.name+'</div><div class="geo-popup-desc">'+c.detail+'</div></div>',{maxWidth:210,className:'geo-popup-wrap'})
        .addTo(geoLayers.cables);
    });

    // Refugee crises â€” amber circle with count
    REFUGEES.forEach(function(r){
      var icon=L.divIcon({className:'',iconSize:[18,18],iconAnchor:[9,9],
        html:'<div style="width:14px;height:14px;border-radius:50%;background:rgba(251,191,36,.12);border:1.5px solid #fbbf24;display:flex;align-items:center;justify-content:center;font-size:5px;color:#fbbf24;font-weight:800;line-height:1;">'+r.count.replace('M','')+'M</div>'
      });
      L.marker([r.lat,r.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:#fbbf24">ğŸ•ï¸ '+r.name+'</div><div class="geo-popup-desc">'+r.detail+'</div><div class="geo-popup-sev" style="background:rgba(251,191,36,.12);color:#fbbf24">'+r.count+' DISPLACED</div></div>',{maxWidth:215,className:'geo-popup-wrap'})
        .addTo(geoLayers.refugees);
    });

    // Sanctions â€” ğŸš« markers
    SANCTIONS.forEach(function(s){
      var icon=L.divIcon({className:'',iconSize:[12,12],iconAnchor:[6,6],
        html:'<div style="font-size:9px;line-height:1;opacity:.85;filter:drop-shadow(0 0 3px '+s.col+'60);">ğŸš«</div>'
      });
      L.marker([s.lat,s.lng],{icon:icon})
        .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+s.col+'">ğŸš« '+s.name+'</div><div class="geo-popup-desc">'+s.detail+'</div></div>',{maxWidth:215,className:'geo-popup-wrap'})
        .addTo(geoLayers.sanctions);
    });

    // Add default visible layers
    geoLayers.conflicts.addTo(geoMap);
    geoLayers.hotspots.addTo(geoMap);
    geoLayers.markets.addTo(geoMap);
    geoLayers.energy.addTo(geoMap);

    renderGeoSidebar();
  }

  window.toggleGeoLayer=function(name){
    var btn=document.querySelector('.geo-btn[data-layer="'+name+'"]');
    if(!btn||!geoMap) return;
    if(geoMap.hasLayer(geoLayers[name])){ geoMap.removeLayer(geoLayers[name]); btn.classList.remove('active'); }
    else { geoLayers[name].addTo(geoMap); btn.classList.add('active'); }
  };

  window.flyToGeo=function(lat,lng){
    if(geoMap) geoMap.flyTo([lat,lng],5,{duration:1.2});
    document.getElementById('global').scrollIntoView({behavior:'smooth'});
  };

  // â”€â”€ NATURAL EVENTS (NASA EONET) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var EONET_CATS={
    '8' :{emoji:'ğŸ”¥',label:'Wildfire',        col:'#f97316'},
    '12':{emoji:'ğŸŒ‹',label:'Volcano',          col:'#ef4444'},
    '17':{emoji:'ğŸŒ‹',label:'Volcanic Eruption',col:'#ef4444'},
    '10':{emoji:'ğŸŒªï¸',label:'Severe Storm',   col:'#818cf8'},
    '9' :{emoji:'ğŸŒŠ',label:'Flood',            col:'#3b82f6'},
    '14':{emoji:'ğŸ”ï¸',label:'Landslide',       col:'#92400e'},
    '15':{emoji:'â„ï¸',label:'Sea/Lake Ice',    col:'#a5f3fc'},
    '7' :{emoji:'ğŸŒ«ï¸',label:'Dust & Haze',    col:'#d4d4d4'},
    '5' :{emoji:'ğŸœï¸',label:'Drought',         col:'#d97706'},
    '16':{emoji:'ğŸŒŠ',label:'Tsunami',          col:'#0ea5e9'},
  };
  var liveNaturalEvents=[], liveFlightCount=0;

  async function fetchNaturalEvents(){
    try{
      var r=await fetch('https://eonet.gsfc.nasa.gov/api/v3/events?status=open&limit=100&days=30');
      var d=await r.json();
      liveNaturalEvents=d.events||[];
      geoLayers.natural.clearLayers();
      liveNaturalEvents.forEach(function(ev){
        var cat=ev.categories&&ev.categories[0];
        var info=cat?EONET_CATS[String(cat.id)]||{emoji:'âš ï¸',label:cat.title||'Event',col:'#f59e0b'}:{emoji:'âš ï¸',label:'Event',col:'#f59e0b'};
        var geo=ev.geometry&&ev.geometry[0];
        if(!geo||!geo.coordinates) return;
        var lat,lng;
        if(geo.type==='Point'){ lat=geo.coordinates[1]; lng=geo.coordinates[0]; }
        else if(geo.type==='Polygon'){ lat=geo.coordinates[0][0][1]; lng=geo.coordinates[0][0][0]; }
        else return;
        if(isNaN(lat)||isNaN(lng)) return;
        var icon=L.divIcon({className:'',iconSize:[16,16],iconAnchor:[8,8],
          html:'<div style="width:12px;height:12px;border-radius:50%;background:'+info.col+';opacity:.85;border:1px solid rgba(255,255,255,.25);box-shadow:0 0 8px '+info.col+'60;animation:pulseMap 2.5s ease-in-out infinite;display:flex;align-items:center;justify-content:center;font-size:7px;">'+info.emoji+'</div>'
        });
        var date=geo.date?geo.date.slice(0,10):'';
        L.marker([lat,lng],{icon:icon})
          .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+info.col+'">'+info.emoji+' '+ev.title+'</div><div class="geo-popup-desc">'+info.label+(date?' Â· '+date:'')+'</div><div class="geo-popup-sev" style="background:rgba(239,68,68,.12);color:'+info.col+'">ACTIVE EVENT</div></div>',{maxWidth:230,className:'geo-popup-wrap'})
          .addTo(geoLayers.natural);
      });
      var nc=document.getElementById('naturalCount'); if(nc) nc.textContent=liveNaturalEvents.length;
      renderNaturalSidebar();
      updateIntelFeed();
    }catch(e){ console.warn('EONET fetch failed',e); }
  }

  function renderNaturalSidebar(){
    var el=document.getElementById('gListNatural'); if(!el) return;
    if(!liveNaturalEvents.length){ el.innerHTML='<div class="geo-evdesc" style="padding:.35rem 0">No active events detected.</div>'; return; }
    var sorted=liveNaturalEvents.slice().sort(function(a,b){
      return new Date((b.geometry&&b.geometry[0]&&b.geometry[0].date)||0)-new Date((a.geometry&&a.geometry[0]&&a.geometry[0].date)||0);
    });
    el.innerHTML=sorted.slice(0,40).map(function(ev){
      var cat=ev.categories&&ev.categories[0];
      var info=cat?EONET_CATS[String(cat.id)]||{emoji:'âš ï¸',label:cat.title||'Event',col:'#f59e0b'}:{emoji:'âš ï¸',label:'Event',col:'#f59e0b'};
      var geo=ev.geometry&&ev.geometry[0];
      var date=geo&&geo.date?geo.date.slice(0,10):'';
      var lat=null,lng=null;
      if(geo&&geo.type==='Point'){ lat=geo.coordinates[1]; lng=geo.coordinates[0]; }
      else if(geo&&geo.type==='Polygon'){ lat=geo.coordinates[0][0][1]; lng=geo.coordinates[0][0][0]; }
      var click=(lat!=null&&lng!=null)?'onclick="flyToGeo('+lat+','+lng+')" title="Click to zoom"':'';
      return '<div class="geo-event elevated" '+click+'><div class="geo-evname"><span>'+info.emoji+' '+ev.title.substring(0,30)+'</span><span class="sev-badge" style="background:rgba(249,115,22,.12);color:'+info.col+'">'+info.label+'</span></div><div class="geo-evdesc">'+date+'</div></div>';
    }).join('');
  }

  // â”€â”€ LIVE FLIGHTS (OpenSky Network) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function fetchFlights(){
    try{
      var r=await fetch('https://opensky-network.org/api/states/all');
      var d=await r.json();
      geoLayers.flights.clearLayers();
      var all=(d.states||[]).filter(function(s){ return s[8]===false&&s[5]!=null&&s[6]!=null&&(s[7]||0)>7000; });
      var step=Math.max(1,Math.floor(all.length/600));
      var count=0;
      for(var i=0;i<all.length;i+=step){
        var s=all[i];
        var lng2=s[5],lat2=s[6],altFt=Math.round((s[7]||0)*3.281);
        var spd=Math.round((s[9]||0)*1.944), track=s[10]||0;
        var call=(s[1]||'').trim()||s[0]||'N/A', country=s[2]||'Unknown';
        var col=altFt>35000?'#60a5fa':altFt>25000?'#818cf8':'#a78bfa';
        var icon=L.divIcon({className:'',iconSize:[8,8],iconAnchor:[4,4],
          html:'<div style="width:0;height:0;border-left:2.5px solid transparent;border-right:2.5px solid transparent;border-bottom:6px solid '+col+';opacity:.7;transform:rotate('+track+'deg);filter:drop-shadow(0 0 2px '+col+'70);"></div>'
        });
        L.marker([lat2,lng2],{icon:icon})
          .bindPopup('<div class="geo-popup-inner"><div class="geo-popup-title" style="color:'+col+'">âœˆï¸ '+call+'</div><div class="geo-popup-desc">'+country+'</div><div class="geo-popup-desc">Alt: '+altFt.toLocaleString()+' ft Â· '+spd+' kts Â· Hdg: '+Math.round(track)+'Â°</div></div>',{maxWidth:200,className:'geo-popup-wrap'})
          .addTo(geoLayers.flights);
        count++;
      }
      liveFlightCount=count;
      var fc=document.getElementById('flightCount'); if(fc) fc.textContent=count;
      renderFlightSidebar(all.length,count);
      updateIntelFeed();
    }catch(e){ console.warn('OpenSky fetch failed',e); }
  }

  function renderFlightSidebar(total,shown){
    var el=document.getElementById('gListFlights'); if(!el) return;
    var ts=new Date().toUTCString().slice(17,25)+' UTC';
    el.innerHTML='<div class="geo-event neutral"><div class="geo-evname">âœˆï¸ Airborne Aircraft<span class="sev-badge" style="background:rgba(96,165,250,.1);color:#60a5fa">LIVE</span></div><div class="geo-evdesc">'+total.toLocaleString()+' detected Â· '+shown+' displayed on map</div></div>'
      +'<div class="geo-event neutral"><div class="geo-evname">ğŸŒ Coverage</div><div class="geo-evdesc">Global ADS-B transponder network Â· &gt;23,000 ft filter</div></div>'
      +'<div class="geo-event neutral"><div class="geo-evname">ğŸ¨ Altitude coding</div><div class="geo-evdesc">Purple &lt;25k ft Â· Indigo 25-35k ft Â· Blue &gt;35k ft</div></div>'
      +'<div class="geo-event neutral"><div class="geo-evname">ğŸ”„ Refresh rate</div><div class="geo-evdesc">~45 seconds Â· Source: OpenSky Network</div></div>'
      +'<div class="geo-event neutral"><div class="geo-evname">ğŸ• Last updated</div><div class="geo-evdesc">'+ts+'</div></div>';
  }

  // â”€â”€ LIVE INTEL TICKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateIntelFeed(){
    var msgs=[];
    var qs=document.getElementById('gStatQuakes');
    if(qs&&qs.textContent&&qs.textContent!=='--') msgs.push('ğŸŒ '+qs.textContent+' EARTHQUAKES DETECTED THIS WEEK (USGS M4.5+)');
    if(liveNaturalEvents.length){
      var fires=liveNaturalEvents.filter(function(e){ var c=e.categories&&e.categories[0]; return c&&String(c.id)==='8'; }).length;
      var volcs=liveNaturalEvents.filter(function(e){ var c=e.categories&&e.categories[0]; return c&&(String(c.id)==='12'||String(c.id)==='17'); }).length;
      var strms=liveNaturalEvents.filter(function(e){ var c=e.categories&&e.categories[0]; return c&&String(c.id)==='10'; }).length;
      if(fires) msgs.push('ğŸ”¥ '+fires+' ACTIVE WILDFIRES TRACKED IN REAL-TIME (NASA EONET)');
      if(volcs) msgs.push('ğŸŒ‹ '+volcs+' ACTIVE VOLCANIC EVENTS UNDER CONTINUOUS MONITORING');
      if(strms) msgs.push('ğŸŒªï¸ '+strms+' SEVERE STORM SYSTEMS BEING TRACKED GLOBALLY');
      msgs.push('âš ï¸ '+liveNaturalEvents.length+' OPEN NATURAL HAZARD EVENTS â€” SOURCE: NASA EONET');
      liveNaturalEvents.slice(0,5).forEach(function(ev){
        var c=ev.categories&&ev.categories[0];
        var info=c?EONET_CATS[String(c.id)]||{emoji:'âš ï¸'}:{emoji:'âš ï¸'};
        msgs.push(info.emoji+' '+ev.title.toUpperCase());
      });
    }
    if(liveFlightCount) msgs.push('âœˆï¸ '+liveFlightCount.toLocaleString()+'+ COMMERCIAL FLIGHTS TRACKED GLOBALLY (OPENSKY ADS-B NETWORK)');
    msgs.push('ğŸ”´ 18 ACTIVE ARMED CONFLICTS Â· RISK LEVEL: CRITICAL Â· UKRAINE / GAZA / SUDAN / DRC');
    msgs.push('âš¡ 14 GEOPOLITICAL FLASHPOINTS UNDER ACTIVE SURVEILLANCE Â· TAIWAN STRAIT: CRITICAL');
    msgs.push('ğŸ›¢ï¸ 12 CRITICAL ENERGY CHOKE POINTS Â· STRAIT OF HORMUZ: 20% GLOBAL OIL TRANSIT');
    msgs.push('ğŸš¢ RED SEA HOUTHI THREAT ZONE ACTIVE Â· COMMERCIAL SHIPPING DIVERSIONS ONGOING');
    msgs.push('â˜¢ï¸ 9 NUCLEAR STATES MONITORED Â· ~13,000 WARHEADS GLOBALLY Â· LAUNCH-ON-WARNING POSTURES');
    msgs.push('ğŸª– 15 STRATEGIC MILITARY INSTALLATIONS MAPPED Â· 6 REGIONS Â· US/NATO/RUSSIA/CHINA');
    msgs.push('ğŸ•ï¸ 44M+ PEOPLE DISPLACED GLOBALLY ACROSS 9 MONITORED CRISIS ZONES');
    msgs.push('ğŸš« 8 SANCTIONED STATES Â· RUSSIA SWIFT REMOVAL Â· IRAN NUCLEAR SANCTIONS Â· DPRK EMBARGO');
    msgs.push('ğŸ”Œ 10 SUBMARINE CABLE HUBS TRACKED Â· CRITICAL INTERNET INFRASTRUCTURE MONITORING');
    if(!msgs.length) return;
    var text=msgs.join('   Â·   ');
    var doubled=text+'   Â·   '+text;
    var el=document.getElementById('geoIntelTicker'); if(!el) return;
    el.textContent=doubled;
    var dur=Math.max(50,Math.round(text.length*0.16));
    el.style.animation='none';
    el.offsetHeight;
    el.style.animation='tickerScroll '+dur+'s linear infinite';
  }

  window.switchGeoTab=function(name){
    document.querySelectorAll('.geo-side-tab-btn').forEach(function(b){ b.classList.remove('stab-active'); });
    document.querySelectorAll('.geo-tab-pane').forEach(function(p){ p.classList.remove('stab-active'); });
    var btn=document.querySelector('.geo-side-tab-btn[data-stab="'+name+'"]');
    var pane=document.getElementById('gPane'+name.charAt(0).toUpperCase()+name.slice(1));
    if(btn)  btn.classList.add('stab-active');
    if(pane) pane.classList.add('stab-active');
  };

  function sevBadge(sev){
    var cls=sev==='critical'?'sev-crit':sev==='high'?'sev-high':'sev-elev';
    return '<span class="sev-badge '+cls+'">'+sev.toUpperCase()+'</span>';
  }

  function renderGeoSidebar(){
    var ce=document.getElementById('gListConflicts'),
        he=document.getElementById('gListHotspots'),
        ee=document.getElementById('gListEnergy'),
        re=document.getElementById('gListRefugees');
    if(ce) ce.innerHTML=CONFLICTS.map(function(c){
      return '<div class="geo-event '+c.sev+'" onclick="flyToGeo('+c.lat+','+c.lng+')" title="Click to zoom"><div class="geo-evname">'+c.name+sevBadge(c.sev)+'</div><div class="geo-evdesc">'+c.detail+'</div></div>';
    }).join('');
    if(he) he.innerHTML=HOTSPOTS.map(function(h){
      return '<div class="geo-event '+h.sev+'" onclick="flyToGeo('+h.lat+','+h.lng+')" title="Click to zoom"><div class="geo-evname">'+h.name+sevBadge(h.sev)+'</div><div class="geo-evdesc">'+h.detail+'</div></div>';
    }).join('');
    if(ee) ee.innerHTML=ENERGY.map(function(e){
      return '<div class="geo-event neutral" onclick="flyToGeo('+e.lat+','+e.lng+')" title="Click to zoom"><div class="geo-evname">'+e.icon+' '+e.name+'</div><div class="geo-evdesc">'+e.detail+'</div></div>';
    }).join('');
    if(re) re.innerHTML=REFUGEES.map(function(r){
      return '<div class="geo-event elevated" onclick="flyToGeo('+r.lat+','+r.lng+')" title="Click to zoom"><div class="geo-evname">ğŸ•ï¸ '+r.name+'<span class="sev-badge sev-elev">'+r.count+'</span></div><div class="geo-evdesc">'+r.detail+'</div></div>';
    }).join('');
    renderEarthquakeSidebar([]);
  }

  // â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function init(){
    renderCurrencies();
    renderRisk();
    tick();
    fetchFG();
    fetchCrypto();
    initGeoMap();
    fetchEarthquakes();
    fetchNaturalEvents();
    fetchFlights();
    // Stagger fetch starts to avoid all hitting at once
    setTimeout(updateIntelFeed, 2000);
    setInterval(tick,1000);
    setInterval(function(){fetchFG();fetchCrypto();},60000);
    setInterval(fetchEarthquakes,180000);    // quakes:   3 min
    setInterval(fetchNaturalEvents,480000);  // EONET:    8 min
    setInterval(fetchFlights,45000);         // flights: 45 sec
  }

  document.readyState==='loading'?document.addEventListener('DOMContentLoaded',init):init();
}());
</script>
</body>
</html>
